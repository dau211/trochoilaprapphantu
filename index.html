
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L·∫Øp R√°p Ph√¢n T·ª≠ ‚Äì H√≥a h·ªçc ph·ªè th√¥ng</title>
    <!-- Import Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Pacifico&family=Roboto+Slab:wght@900&family=Nunito:wght@700&family=Itim&display=swap" rel="stylesheet">
    <!-- Markdown Parser for AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            /* Rainbow Pastel Palette for Backgrounds */
            --bg-left: linear-gradient(180deg, #fff1f2 0%, #ffe4e6 100%); /* H·ªìng ph·∫•n r·∫•t nh·∫°t */
            --bg-center: linear-gradient(180deg, #fffbeb 0%, #fef3c7 100%); /* V√†ng kem */
            --bg-right: linear-gradient(180deg, #f0f9ff 0%, #e0f2fe 100%); /* Xanh tr·ªùi */
            --primary-color: #e91e63;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #fafafa;
            margin: 0;
            height: 100vh;
            display: flex;
            overflow: hidden;
            user-select: none;
            font-size: 15px;
        }

        /* --- DIAMOND COUNTER --- */
        #diamond-counter {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            border-radius: 30px;
            font-family: 'Roboto Slab', serif;
            font-weight: 900;
            font-size: 1.5rem;
            color: #29b6f6;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 3px solid #b3e5fc;
            z-index: 10000;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* --- LASER SCAN EFFECT --- */
        #laser-line {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 5px;
            background: #00e676;
            box-shadow: 0 0 15px #00e676, 0 0 30px #69f0ae;
            z-index: 9999;
            display: none;
            opacity: 0.8;
            pointer-events: none;
        }
        @keyframes scanMove {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }

        /* --- SUCCESS OVERLAY --- */
        #success-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 9998;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }
        #big-check {
            font-size: 8rem;
            color: #4caf50;
            text-shadow: 0 5px 15px rgba(76,175,80,0.4);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #success-text {
            font-family: 'Roboto Slab', serif;
            font-size: 2rem;
            color: #2e7d32;
            margin-top: 20px;
            font-weight: 900;
        }
        @keyframes popIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- 1. C·ªòT TR√ÅI (H·ªìng - ƒêi·ªÅu khi·ªÉn) --- */
        .col-left {
            width: 25%;
            background: var(--bg-left);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 10;
            overflow-y: auto;
            border-right: 1px solid rgba(255,255,255,0.5);
        }

        .control-panel {
            background: rgba(255,255,255,0.6);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            border: 2px solid #fff;
        }

        .panel-title {
            text-align: center; color: var(--primary-color); 
            font-family: 'Roboto Slab', serif; font-weight: 900; font-size: 1.1rem;
            text-transform: uppercase; margin-bottom: 12px; 
            text-shadow: 1px 1px 0px rgba(255,255,255,0.8);
            border-bottom: 2px dashed #f48fb1; padding-bottom: 8px;
        }

        label { font-size: 0.9rem; font-weight: 800; color: #c2185b; margin-bottom: 5px; display: block; }

        select#compoundSelect {
            width: 100%; padding: 10px 35px 10px 15px; border: 2px solid #ddd; border-radius: 15px; 
            background-color: #ffffff; color: #333; font-weight: 800; font-size: 0.9rem; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            appearance: none; -webkit-appearance: none; -moz-appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat; background-position: right 12px center; background-size: 12px;
            cursor: pointer; outline: none; transition: all 0.2s;
        }
        select#compoundSelect:hover { border-color: #f48fb1; }

        .task-info {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            color: #d81b60; padding: 8px; border-radius: 15px; text-align: center;
            box-shadow: 0 4px 8px rgba(255, 154, 158, 0.3); margin-top: 10px;
            border: 2px solid #fff;
        }

        .chem-formula { font-family: 'Courier New', monospace; font-size: 1.6rem; font-weight: 900; text-shadow: 1px 1px 0px rgba(255,255,255,0.5); }

        .btn {
            width: 100%; padding: 10px 5px; border: none; border-radius: 15px;
            font-family: 'Nunito', sans-serif; font-size: 0.95rem; font-weight: 900; cursor: pointer;
            color: white; transition: all 0.3s ease; margin-top: 10px;
            display: flex; align-items: center; justify-content: center; gap: 6px;
            text-transform: uppercase; letter-spacing: 0.5px; text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .btn:active { transform: scale(0.95) !important; }
        .btn:hover { filter: brightness(1.1); transform: translateY(-2px); }

        .btn-ai { background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%); box-shadow: 0 4px 10px rgba(118, 75, 162, 0.4); }
        #btnSkeleton { background-image: linear-gradient(135deg, #FF8008 0%, #FFC837 100%); box-shadow: 0 4px 10px rgba(255, 128, 8, 0.4); }
        #btnDraw { background-image: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); box-shadow: 0 4px 10px rgba(0, 242, 254, 0.4); }
        #btnDraw.active { border: 2px solid #fff; box-shadow: 0 0 0 2px #00f2fe, inset 0 2px 4px rgba(0,0,0,0.3); }
        .btn-reset { background-image: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%); box-shadow: 0 4px 10px rgba(255, 65, 108, 0.4); }
        .btn-check { background-image: linear-gradient(135deg, #0ba360 0%, #3cba92 100%); box-shadow: 0 4px 10px rgba(11, 163, 96, 0.4); }
        
        .music-area { margin-top: auto; padding-top: 10px; border-top: 2px dashed #f48fb1; }
        .music-title { text-align: center; font-family: 'Dancing Script', cursive; font-size: 1.2rem; color: #d81b60; margin-bottom: 5px; }
        .music-btns { display: flex; gap: 5px; }
        .btn-music { flex: 1; margin-top: 0; background: #fce4ec; color: #880e4f; font-family: 'Nunito', sans-serif; font-size: 0.85rem; font-weight: bold; padding: 8px; border-radius: 12px; border: 1px solid #f8bbd0; cursor: pointer; white-space: nowrap; }

        #btnBallStick { background-image: linear-gradient(135deg, #3f51b5 0%, #303f9f 100%); color: #fff; box-shadow: 0 4px 8px rgba(63, 81, 181, 0.4); }
        #btnSpaceFill { background-image: linear-gradient(135deg, #009688 0%, #00796b 100%); color: #fff; box-shadow: 0 4px 8px rgba(0, 150, 136, 0.4); }
        #btnBallStick.active, #btnSpaceFill.active { background-image: linear-gradient(135deg, #f8bbd0 0%, #f48fb1 100%); color: #880e4f; border: 2px solid #880e4f; }

        /* SVG container style */
        #skeletonContainer { width: 100%; display: flex; justify-content: center; background: #fff; border-radius: 10px; padding: 10px; box-shadow: inset 0 0 5px rgba(0,0,0,0.05); }
        #skeletonContainer svg { max-width: 100%; height: auto; max-height: 150px; transition: transform 0.3s; cursor: zoom-in; }
        #skeletonContainer svg.zoomed { transform: scale(1.5); cursor: zoom-out; }

        /* Main Workspace Skeleton View - UPDATED SIZE */
        #main-skeleton-view {
            width: 100%; height: 100%;
            display: none;
            justify-content: center; align-items: center;
            position: absolute; top:0; left:0; z-index: 20;
            pointer-events: none;
        }
        #main-skeleton-view svg {
            /* Reduced size for better visibility */
            max-width: 60%; max-height: 60%;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15));
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* --- 2. C·ªòT GI·ªÆA (V√†ng - L·∫Øp r√°p) --- */
        .col-center { width: 50%; background: var(--bg-center); display: flex; flex-direction: column; padding: 15px; position: relative; }
        .header-3d { background: #ffffff; padding: 10px 20px; border-radius: 25px; box-shadow: 6px 6px 12px rgba(0,0,0,0.08), -6px -6px 12px rgba(255,255,255,0.9); text-align: center; margin-bottom: 15px; border: 2px solid #fff59d; }
        
        /* Updated Main Title for single line fitting */
        .main-title { 
            font-family: 'Roboto Slab', serif; 
            font-size: 1.5rem; /* Reduced size */
            font-weight: 900; 
            background: linear-gradient(to right, #ff00cc, #333399, #ff00cc); 
            background-size: 200% auto; 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            text-transform: uppercase; 
            margin: 0; 
            letter-spacing: 2px; 
            animation: rainbowMove 3s linear infinite; 
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1); 
            filter: drop-shadow(0px 2px 4px rgba(0,0,0,0.2));
            white-space: nowrap; /* Force single line */
        }
        @keyframes rainbowMove { to { background-position: 200% center; } }

        .cute-text { font-family: 'Pacifico', cursive; font-size: 1.2rem; color: #558b2f; margin: 5px 0 0 0; text-shadow: 1px 1px 0px #fff; }
        .school-name { font-family: 'Nunito', sans-serif; font-size: 0.9rem; font-weight: 700; color: #795548; margin-top: 2px; font-style: italic; }

        .workspace { flex: 1; background: #ffffff; border-radius: 30px; box-shadow: inset 4px 4px 8px rgba(0,0,0,0.05), inset -4px -4px 8px rgba(255,255,255,0.9); position: relative; overflow: hidden; border: 4px solid #fff9c4; cursor: default; }
        .workspace.drawing { cursor: crosshair; }
        #bond-layer { position: absolute; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 5; }

        .toolbar-area { height: 90px; display: flex; justify-content: center; align-items: center; margin-top: 15px; }
        .toolbar-box { background: #fffde7; padding: 8px 25px; border-radius: 50px; box-shadow: 6px 6px 12px rgba(0,0,0,0.1), -6px -6px 12px rgba(255,255,255,0.8); display: flex; gap: 15px; border: 2px solid #fff; }
        .atom-slot { width: 45px; height: 45px; border-radius: 50%; background: #fff9c4; box-shadow: inset 3px 3px 6px rgba(0,0,0,0.1), inset -3px -3px 6px rgba(255,255,255,0.8); display: flex; justify-content: center; align-items: center; }
        .atom-label { text-align: center; font-size: 0.75rem; font-weight: 800; color: #555; margin-top: 4px; text-transform: uppercase; }

        .atom { border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 900; color: white; box-shadow: inset -3px -3px 8px rgba(0, 0, 0, 0.4), inset 3px 3px 8px rgba(255, 255, 255, 0.4), 2px 3px 6px rgba(0,0,0,0.3); cursor: grab; z-index: 10; user-select: none; position: absolute; transition: transform 0.1s; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); }
        .atom:active { cursor: grabbing; transform: scale(1.1); }
        
        .h-atom { background: radial-gradient(circle at 35% 35%, #ffffff, #bdbdbd); color: #333; width: 28px; height: 28px; font-size: 0.8rem; }
        .c-atom { background: radial-gradient(circle at 35% 35%, #757575, #212121); width: 40px; height: 40px; font-size: 1rem; } 
        .o-atom { background: radial-gradient(circle at 35% 35%, #ff8a80, #c62828); width: 40px; height: 40px; font-size: 1rem; } 
        .n-atom { background: radial-gradient(circle at 35% 35%, #82b1ff, #1565c0); width: 40px; height: 40px; font-size: 1rem; } 
        .cl-atom { background: radial-gradient(circle at 35% 35%, #a5d6a7, #2e7d32); width: 40px; height: 40px; font-size: 1rem; }

        /* --- 3. C·ªòT PH·∫¢I (Xanh - Th√¥ng tin) --- */
        .col-right { width: 25%; background: var(--bg-right); padding: 20px; box-sizing: border-box; display: flex; flex-direction: column; gap: 15px; margin: 15px; border-radius: 25px; box-shadow: 2px 0 10px rgba(0,0,0,0.05); border: 3px solid #ffffff; overflow-y: auto; }
        .prop-header { text-align: center; color: #0277bd; font-family: 'Roboto Slab', serif; font-weight: 900; font-size: 1.3rem; margin-bottom: 5px; text-transform: uppercase; text-shadow: 1px 1px 0px #fff; border-bottom: 2px solid #81d4fa; padding-bottom: 10px; }
        .prop-box { background: rgba(255,255,255,0.7); border-radius: 15px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); transition: all 0.3s ease; }
        .prop-box.active { box-shadow: 0 6px 12px rgba(0,0,0,0.1); background: #fff; }
        .prop-trigger { padding: 12px 15px; background: rgba(255,255,255,0.4); cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .prop-trigger:hover { background: rgba(255,255,255,0.8); }
        .prop-label { font-size: 0.9rem; color: #01579b; font-weight: 800; text-transform: uppercase; }
        .toggle-icon { font-weight: bold; color: #0288d1; font-size: 1rem; transition: transform 0.3s; }
        .prop-box.active .toggle-icon { transform: rotate(180deg); }
        .prop-content { display: none; padding: 15px; font-size: 0.9rem; color: #333; line-height: 1.5; font-weight: 600; background: #fff; border-top: 1px dashed #b3e5fc; max-height: 300px; overflow-y: auto; }
        .prop-box.active .prop-content { display: block; animation: slideDown 0.3s ease-out; }
        
        .struct-formula { font-family: 'Courier New', monospace; font-weight: bold; font-size: 1.3rem; color: #d84315; text-align: center; }
        .guide-text { color: #d84315; font-weight: bold; }
        .skeletal-guide { font-style: italic; color: #555; background: #f0f4c3; padding: 10px; border-radius: 8px; margin-top: 10px; border-left: 4px solid #cddc39; }

        /* QUIZ STYLES */
        .quiz-container { display: flex; flex-direction: column; gap: 10px; }
        .quiz-question { font-weight: bold; color: #01579b; margin-bottom: 5px; }
        .quiz-options { display: flex; flex-direction: column; gap: 5px; }
        .quiz-btn { background: #e1f5fe; border: 1px solid #b3e5fc; padding: 8px; border-radius: 8px; text-align: left; cursor: pointer; transition: 0.2s; font-size: 0.85rem; }
        .quiz-btn:hover { background: #b3e5fc; }
        .quiz-btn.correct { background: #c8e6c9; border-color: #4caf50; color: #2e7d32; }
        .quiz-btn.wrong { background: #ffcdd2; border-color: #ef5350; color: #c62828; }
        .quiz-feedback { margin-top: 5px; font-size: 0.8rem; font-style: italic; }
        .quiz-reward { color: #ffca28; font-weight: bold; margin-left: 5px; }

        #notification { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); padding: 10px 25px; border-radius: 30px; color: white; font-weight: bold; font-size: 1rem; box-shadow: 0 8px 20px rgba(0,0,0,0.25); display: none; z-index: 200; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.92); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .modal-box { background: #fff; width: 90%; height: 90%; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 0 30px rgba(255,255,255,0.2); }
        .modal-header { padding: 15px 20px; background: #eee; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h3 { font-size: 1.3rem; color: #1565c0; font-weight: 900; margin: 0; }
        .close-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #c62828; }
        #canvas3d { flex: 1; background: #000; position: relative; width: 100%; }
        .modal-footer { padding: 15px; display: flex; justify-content: center; gap: 20px; background: #f5f5f5; align-items: center;}

        /* Chat Styles */
        .chat-container { flex: 1; display: flex; flex-direction: column; padding: 20px; background: #fdf2f8; overflow: hidden; }
        .chat-messages { flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; padding-bottom: 15px; }
        .message { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 1rem; line-height: 1.5; }
        .msg-ai { align-self: flex-start; background: #fff; border: 2px solid #f8bbd0; color: #880e4f; border-bottom-left-radius: 0; }
        .msg-user { align-self: flex-end; background: #e1bee7; color: #4a148c; border-bottom-right-radius: 0; }
        .chat-input-area { display: flex; gap: 10px; padding-top: 10px; border-top: 1px dashed #f48fb1; }
        .chat-input { flex: 1; padding: 12px; border: 2px solid #f48fb1; border-radius: 25px; outline: none; font-size: 1rem; }
        .chat-send { background: #ad1457; color: white; border: none; padding: 0 25px; border-radius: 25px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .chat-send:hover { background: #880e4f; }
        .typing-indicator { font-style: italic; color: #888; font-size: 0.9rem; margin-left: 10px; display: none; }

        @media (max-width: 1024px) {
            body { flex-direction: column; overflow: auto; height: auto; }
            .col-left, .col-center, .col-right { width: 100%; }
            .workspace { height: 500px; }
        }
    </style>
</head>
<body>

    <div id="diamond-counter">üíé <span id="diamond-score">0</span></div>

    <!-- LASER & OVERLAY -->
    <div id="laser-line"></div>
    <div id="success-overlay">
        <div id="big-check">‚úÖ</div>
        <div id="success-text">Tuy·ªát v·ªùi! Ch√≠nh x√°c</div>
    </div>

    <!-- 1. C·ªòT TR√ÅI (ƒêi·ªÅu khi·ªÉn) -->
    <div class="col-left">
        <div class="control-panel">
            <div class="panel-title">B·∫£ng ƒêi·ªÅu Khi·ªÉn</div>
            
            <label>Ch·ªçn ch·∫•t:</label>
            <select id="compoundSelect" onchange="changeTask()">
                <optgroup label="1. Alkane">
                    <option value="ch4">Methane</option>
                    <option value="c2h6">Ethane</option>
                    <option value="c3h8">Propane</option>
                </optgroup>
                <optgroup label="2. Alkene">
                    <option value="c2h4">Ethene</option>
                    <option value="c3h6">Propene</option>
                </optgroup>
                <optgroup label="3. Alkyne">
                    <option value="c2h2">Ethyne</option>
                    <option value="c3h4">Propyne</option>
                </optgroup>
                <optgroup label="4. Halogen">
                    <option value="ch3cl">Chloromethane</option>
                    <option value="c2h5cl">Chloroethane</option>
                </optgroup>
                <optgroup label="5. Hydrocarbon th∆°m">
                    <option value="c6h6">Benzene</option>
                    <option value="c7h8">Methylbenzene (Toluene)</option>
                    <option value="c8h8">Styrene</option>
                </optgroup>
                <optgroup label="6. Alcohol">
                    <option value="ch3oh">Methanol</option>
                    <option value="c2h5oh">Ethanol</option>
                </optgroup>
                <optgroup label="7. Phenol">
                    <option value="c6h5oh">Phenol</option>
                </optgroup>
                <optgroup label="8. Aldehyde">
                    <option value="hcho">Methanal</option>
                    <option value="ch3cho">Ethanal</option>
                </optgroup>
                <optgroup label="9. Carboxylic Acid">
                    <option value="hcooh">Methanoic Acid</option>
                    <option value="ch3cooh">Ethanoic Acid</option>
                </optgroup>
                <optgroup label="10. Ester">
                    <option value="c3h6o2">Methyl Acetate</option>
                    <option value="c4h8o2">Ethyl Acetate</option>
                </optgroup>
                <optgroup label="11. Amine">
                    <option value="ch5n">Methylamine</option>
                    <option value="c2h7n">Ethylamine</option>
                    <option value="c4h11n">Diethylamine</option>
                    <option value="c3h9n">Trimethylamine</option>
                    <option value="c6h7n">Aniline</option>
                </optgroup>
                <optgroup label="12. Amino Acid">
                    <option value="c2h5no2">Glycine</option>
                    <option value="c3h7no2">Alanine</option>
                    <option value="c5h11no2">Valine</option>
                    <option value="c6h14n2o2">Lysine</option>
                    <option value="c5h9no4">Glutamic Acid</option>
                </optgroup>
            </select>

            <div class="task-info">
                <div id="taskFormula" class="chem-formula">CH‚ÇÑ</div>
            </div>

            <!-- BUTTONS WITH NUNITO FONT -->
         
            <button class="btn" id="btnSkeleton" onclick="createSkeleton()">‚¨° T·∫°o khung</button>
            <button class="btn" id="btnDraw" onclick="toggleDraw()">‚úèÔ∏è V·∫Ω li√™n k·∫øt</button>
            <button class="btn btn-reset" onclick="resetBoard()">üóëÔ∏è X√≥a b√†n</button>
            <button class="btn btn-check" onclick="checkResult()">üìë Ki·ªÉm tra</button>

            <!-- MUSIC CONTROLS -->
            <div class="music-area">
                <div class="music-title">üéµ Music Lounge</div>
                <div class="music-btns">
                    <button class="btn-music" onclick="document.getElementById('musicInput').click()">üìÇ M·ªü nh·∫°c</button>
                    <button class="btn-music" id="btnPlayMusic" onclick="toggleMusic()">‚ñ∂Ô∏è B·∫≠t/T·∫Øt</button>
                </div>
                <input type="file" id="musicInput" accept="audio/*" style="display:none" onchange="handleMusicFile(this)">
                <audio id="bgAudio" loop></audio>
            </div>
        </div>
    </div>

    <!-- 2. C·ªòT GI·ªÆA (L·∫Øp r√°p) -->
    <div class="col-center">
        <div class="header-3d">
            <h1 class="main-title">TR√í CH∆†I L·∫ÆP R√ÅP PH√ÇN T·ª¨</h1>
            <p class="cute-text">H√≥a h·ªçc ph·ªï th√¥ng</p>
           
        </div>

        <div class="workspace" id="workspace">
            <div id="notification">Th√¥ng b√°o</div>
            <div id="main-skeleton-view"></div>
            <svg id="bond-layer"></svg>
        </div>

        <div class="toolbar-area">
            <div class="toolbar-box">
                <div style="text-align:center;">
                    <div class="atom-slot"><div class="atom c-atom" draggable="true" ondragstart="dragStart(event, 'C')">C</div></div>
                    <div class="atom-label">Carbon</div>
                </div>
                <div style="text-align:center;">
                    <div class="atom-slot"><div class="atom h-atom" draggable="true" ondragstart="dragStart(event, 'H')">H</div></div>
                    <div class="atom-label">Hydrogen</div>
                </div>
                <div style="text-align:center;">
                    <div class="atom-slot"><div class="atom o-atom" draggable="true" ondragstart="dragStart(event, 'O')">O</div></div>
                    <div class="atom-label">Oxygen</div>
                </div>
                <div style="text-align:center;">
                    <div class="atom-slot"><div class="atom n-atom" draggable="true" ondragstart="dragStart(event, 'N')">N</div></div>
                    <div class="atom-label">Nitrogen</div>
                </div>
                <div style="text-align:center;">
                    <div class="atom-slot"><div class="atom cl-atom" draggable="true" ondragstart="dragStart(event, 'Cl')">Cl</div></div>
                    <div class="atom-label">Chlorine</div>
                </div>
            </div>
        </div>
    </div>

    <!-- 3. C·ªòT PH·∫¢I (Th√¥ng tin ch·∫•t) -->
    <div class="col-right">
        <div class="prop-header">N·ªòI DUNG H·ªåC T·∫¨P</div>
        
        <!-- Box 0: H∆∞·ªõng d·∫´n l·∫Øp r√°p -->
        <div class="prop-box" onclick="toggleProp(this)">
            <div class="prop-trigger">
                <div class="prop-label">G·ª£i √Ω l·∫Øp r√°p</div>
                <div class="toggle-icon">‚ñº</div>
            </div>
            <div class="prop-content">
                <div class="guide-text" id="propGuide"></div>
            </div>
        </div>

        <!-- Box 1 -->
        <div class="prop-box" onclick="toggleProp(this)">
            <div class="prop-trigger">
                <div class="prop-label">C·∫•u t·∫°o thu g·ªçn</div>
                <div class="toggle-icon">‚ñº</div>
            </div>
            <div class="prop-content">
                <div class="struct-formula" id="propStruct">CH4</div>
            </div>
        </div>
        
        <!-- Box 1.5: Skeletal Structure & Guide (MODIFIED) -->
        <div class="prop-box active" onclick="toggleProp(this)">
            <div class="prop-trigger">
                <div class="prop-label">C√îNG TH·ª®C KHUNG PH√ÇN T·ª¨</div>
                <div class="toggle-icon">‚ñº</div>
            </div>
            <div class="prop-content">
                <div class="skeletal-guide" id="skeletalGuide">
                    <!-- Guide text injected here -->
                </div>
            </div>
        </div>

        <!-- Box 4: Quiz (NEW) -->
        <div class="prop-box" onclick="toggleProp(this)">
            <div class="prop-trigger">
                <div class="prop-label">G√ìC TR·∫ÆC NGHI·ªÜM</div>
                <div class="toggle-icon">‚ñº</div>
            </div>
            <div class="prop-content" id="quizContent">
                <!-- Quiz injected here -->
            </div>
        </div>
    </div>

    <!-- 3D MODAL -->
    <div id="modal3d" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="modalTitle">M√¥ h√¨nh 3D</h3>
                <button class="close-btn" onclick="closeModal()">‚úñ</button>
            </div>
            <div id="canvas3d">
                <div id="loadingText" style="color:white; position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:1.5rem;">ƒêang t·∫£i...</div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="btnBallStick" style="width:auto;" onclick="setRenderMode('ballStick')">R·ªóng</button>
                <button class="btn" id="btnSpaceFill" style="width:auto;" onclick="setRenderMode('spaceFill')">ƒê·∫∑c</button>
                <button class="btn" style="width:auto; background:#ffe0b2; color:#e65100;" id="btnRotate" onclick="toggleRotate()">‚è∏Ô∏è D·ª´ng xoay</button>
                <button class="btn" style="width:auto; background:#ffcc80; color:#e65100;" onclick="closeModal()">‚¨ÖÔ∏è Quay l·∫°i</button>
            </div>
        </div>
    </div>

    
    <script>
        // *** GEMINI API CONFIGURATION ***
        const apiKey = "AIzaSyCnP6xAmTS4YN2bo63M7vuzzXZwnDPDTXo"; // <--- ƒêI·ªÄN API KEY C·ª¶A B·∫†N V√ÄO ƒê√ÇY

        let diamonds = 0;
        const diamondEl = document.getElementById('diamond-score');

        async function callGemini(promptText) {
            if (!apiKey) {
                notify("‚ö†Ô∏è Ch∆∞a nh·∫≠p API Key!", false);
                return "L·ªói: Vui l√≤ng nh·∫≠p API Key trong m√£ ngu·ªìn ƒë·ªÉ s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y.";
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: promptText }] }]
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const data = await response.json();
                if (data.error) {
                    console.error("Gemini API Error:", data.error);
                    return "Xin l·ªói, t√¥i ƒëang b·∫≠n ch√∫t x√≠u (L·ªói k·∫øt n·ªëi AI). B·∫°n th·ª≠ l·∫°i sau nh√©!";
                }
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Fetch Error:", error);
                return "C√≥ l·ªói x·∫£y ra khi k·∫øt n·ªëi v·ªõi m√°y ch·ªß.";
            }
        }

       

        // --- DATA WITH SKELETAL GUIDE & QUIZ ---
        // Guide Rules: Zig-zag chain, C-H implicit, Heteroatoms explicit
        const db = {
            'ch4': { 
                n:'Methane', f:'CH‚ÇÑ', s:'CH‚ÇÑ', req:{C:1,H:4}, 
                guide: "L·∫•y 1 nguy√™n t·ª≠ Carbon (ƒëen) v√† 4 nguy√™n t·ª≠ Hydrogen (tr·∫Øng). ƒê·∫∑t C ·ªü gi·ªØa v√† g·∫Øn 4 H xung quanh ƒë·ªÉ t·∫°o h√¨nh t·ª© di·ªán ƒë·ªÅu.",
                sk_guide: "Methane l√† alkane ƒë∆°n gi·∫£n nh·∫•t. Khung ph√¢n t·ª≠ ch·ªâ l√† m·ªôt ƒëi·ªÉm (t∆∞·ª£ng tr∆∞ng cho C), nh∆∞ng th∆∞·ªùng vi·∫øt ƒë·∫ßy ƒë·ªß CH‚ÇÑ ƒë·ªÉ tr√°nh nh·∫ßm l·∫´n.",
                quiz: [
                    {q: "C√¥ng th·ª©c ph√¢n t·ª≠ c·ªßa Methane l√† g√¨?", opt: ["CH‚ÇÇ", "CH‚ÇÉ", "CH‚ÇÑ", "C‚ÇÇH‚ÇÜ"], ans: 2},
                    {q: "Trong ph√¢n t·ª≠ Methane c√≥ bao nhi√™u li√™n k·∫øt sigma (œÉ)?", opt: ["1", "2", "3", "4"], ans: 3, expl: "C√≥ 4 li√™n k·∫øt ƒë∆°n C-H, m·ªói li√™n k·∫øt ƒë∆°n l√† 1 sigma."},
                    {q: "Nguy√™n t·ª≠ Carbon trong Methane ·ªü tr·∫°ng th√°i lai h√≥a n√†o?", opt: ["sp", "sp¬≤", "sp¬≥", "Kh√¥ng lai h√≥a"], ans: 2},
                    {q: "H√¨nh d·∫°ng kh√¥ng gian c·ªßa ph√¢n t·ª≠ Methane l√† g√¨?", opt: ["Tam gi√°c ƒë·ªÅu", "T·ª© di·ªán ƒë·ªÅu", "ƒê∆∞·ªùng th·∫≥ng", "G·∫•p kh√∫c"], ans: 1},
                    {q: "G√≥c li√™n k·∫øt H-C-H trong Methane l√† bao nhi√™u?", opt: ["90¬∞", "109,5¬∞", "120¬∞", "180¬∞"], ans: 1}
                ]
            },
            'c2h6': { 
                n:'Ethane', f:'C‚ÇÇH‚ÇÜ', s:'CH‚ÇÉ-CH‚ÇÉ', req:{C:2,H:6}, 
                guide: "L·∫•y 2 nguy√™n t·ª≠ Carbon v√† 6 nguy√™n t·ª≠ Hydrogen. N·ªëi 2 C v·ªõi nhau tr∆∞·ªõc, sau ƒë√≥ chia ƒë·ªÅu m·ªói C g·∫Øn v·ªõi 3 H.",
                sk_guide: "V·∫Ω m·ªôt ƒëo·∫°n th·∫≥ng. Hai ƒë·∫ßu m√∫t c·ªßa ƒëo·∫°n th·∫≥ng ƒë·∫°i di·ªán cho 2 nguy√™n t·ª≠ Carbon. C√°c nguy√™n t·ª≠ H li√™n k·∫øt v·ªõi C ƒë∆∞·ª£c ·∫©n ƒëi.",
                quiz: [
                    {q: "C√¥ng th·ª©c c·∫•u t·∫°o thu g·ªçn c·ªßa Ethane l√†:", opt: ["CH‚ÇÉ-CH‚ÇÇ-CH‚ÇÉ", "CH‚ÇÉ-CH‚ÇÉ", "CH‚ÇÇ=CH‚ÇÇ", "CH‚â°CH"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong ph√¢n t·ª≠ Ethane l√†:", opt: ["5", "6", "7", "8"], ans: 2, expl: "6 li√™n k·∫øt C-H + 1 li√™n k·∫øt C-C = 7 sigma."},
                    {q: "Li√™n k·∫øt gi·ªØa hai nguy√™n t·ª≠ Carbon trong Ethane l√† li√™n k·∫øt g√¨?", opt: ["ƒê∆°n", "ƒê√¥i", "Ba", "Ion"], ans: 0},
                    {q: "Tr·∫°ng th√°i lai h√≥a c·ªßa Carbon trong Ethane:", opt: ["sp", "sp¬≤", "sp¬≥", "dsp¬≤"], ans: 2},
                    {q: "Ethane thu·ªôc d√£y ƒë·ªìng ƒë·∫≥ng n√†o?", opt: ["Alkane", "Alkene", "Alkyne", "Arene"], ans: 0}
                ]
            },
            'c3h8': { 
                n:'Propane', f:'C‚ÇÉH‚Çà', s:'CH‚ÇÉ-CH‚ÇÇ-CH‚ÇÉ', req:{C:3,H:8}, 
                guide: "L·∫•y 3 C v√† 8 H. N·ªëi 3 C th√†nh m·ªôt h√†ng th·∫≥ng. G·∫Øn c√°c H v√†o xung quanh ƒë·ªÉ ƒë·∫£m b·∫£o m·ªói C ƒë·ªß 4 li√™n k·∫øt.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng g·∫•p kh√∫c (zig-zag) g·ªìm 2 ƒëo·∫°n. 3 ƒëi·ªÉm (2 ƒë·∫ßu + 1 ƒë·ªânh) ƒë·∫°i di·ªán cho 3 nguy√™n t·ª≠ Carbon.",
                quiz: [
                    {q: "CTPT c·ªßa Propane l√†:", opt: ["C‚ÇÇH‚ÇÜ", "C‚ÇÉH‚ÇÜ", "C‚ÇÉH‚Çà", "C‚ÇÑH‚ÇÅ‚ÇÄ"], ans: 2},
                    {q: "S·ªë li√™n k·∫øt C-C trong Propane:", opt: ["1", "2", "3", "4"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong ph√¢n t·ª≠ C‚ÇÉH‚Çà:", opt: ["8", "9", "10", "11"], ans: 2, expl: "8 C-H + 2 C-C = 10 sigma."},
                    {q: "Propane l√† th√†nh ph·∫ßn ch√≠nh c·ªßa lo·∫°i kh√≠ n√†o?", opt: ["Kh√≠ biogas", "Kh√≠ thi√™n nhi√™n", "Kh√≠ gas h√≥a l·ªèng (LPG)", "Kh√≠ than ∆∞·ªõt"], ans: 2},
                    {q: "Carbon s·ªë 2 trong Propane li√™n k·∫øt v·ªõi bao nhi√™u H?", opt: ["1", "2", "3", "4"], ans: 1}
                ]
            },
            'c2h4': { 
                n:'Ethene', f:'C‚ÇÇH‚ÇÑ', s:'CH‚ÇÇ=CH‚ÇÇ', req:{C:2,H:4}, 
                guide: "L·∫•y 2 C v√† 4 H. N·ªëi 2 C b·∫±ng li√™n k·∫øt ƒê√îI (v·∫Ω 2 ƒë∆∞·ªùng n·ªëi). Sau ƒë√≥ m·ªói C g·∫Øn th√™m 2 H.",
                sk_guide: "V·∫Ω hai ƒë∆∞·ªùng th·∫≥ng song song s√°t nhau t∆∞·ª£ng tr∆∞ng cho li√™n k·∫øt ƒë√¥i gi·ªØa 2 Carbon.",
                quiz: [
                    {q: "Ethene thu·ªôc d√£y ƒë·ªìng ƒë·∫≥ng n√†o?", opt: ["Alkane", "Alkene", "Alkyne", "Arene"], ans: 1},
                    {q: "Trong Ethene c√≥ bao nhi√™u li√™n k·∫øt pi (œÄ)?", opt: ["0", "1", "2", "3"], ans: 1, expl: "Li√™n k·∫øt ƒë√¥i g·ªìm 1 sigma v√† 1 pi."},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong C‚ÇÇH‚ÇÑ:", opt: ["4", "5", "6", "7"], ans: 1, expl: "4 C-H + 1 C-C = 5 sigma."},
                    {q: "Carbon trong Ethene lai h√≥a:", opt: ["sp", "sp¬≤", "sp¬≥", "Kh√¥ng lai h√≥a"], ans: 1},
                    {q: "G√≥c li√™n k·∫øt H-C-H d·ª± ki·∫øn trong Ethene:", opt: ["109.5¬∞", "120¬∞", "180¬∞", "90¬∞"], ans: 1}
                ]
            },
            'c3h6': { 
                n:'Propene', f:'C‚ÇÉH‚ÇÜ', s:'CH‚ÇÇ=CH-CH‚ÇÉ', req:{C:3,H:6}, 
                guide: "L·∫•y 3 C v√† 6 H. N·ªëi 3 C l·∫°i, trong ƒë√≥ c√≥ m·ªôt li√™n k·∫øt ƒê√îI gi·ªØa 2 C ƒë·∫ßu ti√™n. B·ªï sung H cho ƒë·ªß h√≥a tr·ªã.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng g·∫•p kh√∫c, th√™m m·ªôt n√©t g·∫°ch song song t·∫°i m·ªôt ƒëo·∫°n ƒë·ªÉ bi·ªÉu di·ªÖn li√™n k·∫øt ƒë√¥i.",
                quiz: [
                    {q: "CTPT c·ªßa Propene:", opt: ["C‚ÇÉH‚Çà", "C‚ÇÉH‚ÇÜ", "C‚ÇÉH‚ÇÑ", "C‚ÇÑH‚Çà"], ans: 1},
                    {q: "Propene c√≥ bao nhi√™u li√™n k·∫øt ƒë√¥i C=C?", opt: ["1", "2", "3", "0"], ans: 0},
                    {q: "T·ªïng s·ªë li√™n k·∫øt sigma trong Propene:", opt: ["7", "8", "9", "10"], ans: 1, expl: "6 C-H + 2 C-C = 8 sigma."},
                    {q: "S·∫£n ph·∫©m tr√πng h·ª£p c·ªßa Propene l√†:", opt: ["PE", "PVC", "PP", "PS"], ans: 2},
                    {q: "S·ªë nguy√™n t·ª≠ Carbon lai h√≥a sp¬≤ trong Propene:", opt: ["1", "2", "3", "0"], ans: 1}
                ]
            },
            'c2h2': { 
                n:'Ethyne', f:'C‚ÇÇH‚ÇÇ', s:'CH‚â°CH', req:{C:2,H:2}, 
                guide: "L·∫•y 2 C v√† 2 H. N·ªëi 2 C v·ªõi nhau b·∫±ng li√™n k·∫øt BA (v·∫Ω 3 ƒë∆∞·ªùng n·ªëi). M·ªói C g·∫Øn th√™m 1 H ·ªü hai ƒë·∫ßu.",
                sk_guide: "V·∫Ω ba ƒë∆∞·ªùng th·∫≥ng song song s√°t nhau t∆∞·ª£ng tr∆∞ng cho li√™n k·∫øt ba.",
                quiz: [
                    {q: "T√™n g·ªçi th∆∞·ªùng c·ªßa Ethyne l√†:", opt: ["Etylen", "Axetilen", "Propilen", "Metan"], ans: 1},
                    {q: "Trong ph√¢n t·ª≠ C‚ÇÇH‚ÇÇ c√≥ s·ªë li√™n k·∫øt pi (œÄ) l√†:", opt: ["1", "2", "3", "4"], ans: 1, expl: "Li√™n k·∫øt ba g·ªìm 1 sigma v√† 2 pi."},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong Ethyne:", opt: ["1", "2", "3", "4"], ans: 2, expl: "2 C-H + 1 C-C = 3 sigma."},
                    {q: "Tr·∫°ng th√°i lai h√≥a c·ªßa C trong Ethyne:", opt: ["sp", "sp¬≤", "sp¬≥", "Kh√¥ng lai h√≥a"], ans: 0},
                    {q: "Ph√¢n t·ª≠ Ethyne c√≥ h√¨nh d·∫°ng:", opt: ["T·ª© di·ªán", "Tam gi√°c", "ƒê∆∞·ªùng th·∫≥ng", "G·∫•p kh√∫c"], ans: 2}
                ]
            },
            'c3h4': { 
                n:'Propyne', f:'C‚ÇÉH‚ÇÑ', s:'CH‚â°C-CH‚ÇÉ', req:{C:3,H:4}, 
                guide: "L·∫•y 3 C v√† 4 H. N·ªëi 3 C l·∫°i, t·∫°o m·ªôt li√™n k·∫øt BA ·ªü ƒë·∫ßu m·∫°ch. G·∫Øn H sao cho C ƒë·∫ßu c√≥ 1H, C gi·ªØa kh√¥ng c√≥ H, C cu·ªëi c√≥ 3H.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng th·∫≥ng cho ph·∫ßn li√™n k·∫øt ba, n·ªëi ti·∫øp zic-zac ra nh√≥m th·∫ø. Li√™n k·∫øt ba th·ªÉ hi·ªán b·∫±ng 3 g·∫°ch.",
                quiz: [
                    {q: "CTPT c·ªßa Propyne l√†:", opt: ["C‚ÇÉH‚ÇÜ", "C‚ÇÉH‚ÇÑ", "C‚ÇÉH‚Çà", "C‚ÇÑH‚ÇÜ"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt pi (œÄ) trong Propyne:", opt: ["1", "2", "3", "4"], ans: 1},
                    {q: "T·ªïng s·ªë li√™n k·∫øt sigma (œÉ):", opt: ["4", "5", "6", "7"], ans: 2, expl: "4 C-H + 2 C-C = 6 sigma."},
                    {q: "Propyne c√≥ ph·∫£n ·ª©ng v·ªõi AgNO‚ÇÉ/NH‚ÇÉ kh√¥ng?", opt: ["C√≥", "Kh√¥ng", "Ch·ªâ khi ƒëun n√≥ng", "Ch·ªâ khi c√≥ x√∫c t√°c"], ans: 0},
                    {q: "S·ªë nguy√™n t·ª≠ C lai h√≥a sp trong Propyne:", opt: ["1", "2", "3", "0"], ans: 1}
                ]
            },
            'ch3cl': { 
                n:'Chloromethane', f:'CH‚ÇÉCl', s:'CH‚ÇÉ-Cl', req:{C:1,H:3,Cl:1}, 
                guide: "L·∫•y 1 C, 3 H v√† 1 Chlorine (xanh l√°). G·∫Øn t·∫•t c·∫£ xung quanh nguy√™n t·ª≠ C trung t√¢m.",
                sk_guide: "V·∫Ω m·ªôt ƒëo·∫°n th·∫≥ng, m·ªôt ƒë·∫ßu ƒë·ªÉ tr·ªëng (hi·ªÉu l√† C), ƒë·∫ßu kia ghi k√≠ hi·ªáu Cl.",
                quiz: [
                    {q: "Chloromethane thu·ªôc lo·∫°i d·∫´n xu·∫•t n√†o?", opt: ["Halogen", "Alcohol", "Phenol", "Amin"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong CH‚ÇÉCl:", opt: ["2", "3", "4", "5"], ans: 2},
                    {q: "C√¥ng th·ª©c t·ªïng qu√°t c·ªßa d·∫´n xu·∫•t monochloro alkane no l√†:", opt: ["CnH2nCl", "CnH2n+1Cl", "CnH2n-1Cl", "CnH2n+2Cl"], ans: 1},
                    {q: "M√¥ h√¨nh ph√¢n t·ª≠ CH‚ÇÉCl t∆∞∆°ng t·ª± ch·∫•t n√†o?", opt: ["CH‚ÇÑ", "C‚ÇÇH‚ÇÑ", "C‚ÇÇH‚ÇÇ", "C‚ÇÜH‚ÇÜ"], ans: 0},
                    {q: "Nguy√™n t·ª≠ Cl li√™n k·∫øt v·ªõi C b·∫±ng li√™n k·∫øt:", opt: ["C·ªông h√≥a tr·ªã", "Ion", "Kim lo·∫°i", "Hydro"], ans: 0}
                ]
            },
            'c2h5cl': { 
                n:'Chloroethane', f:'C‚ÇÇH‚ÇÖCl', s:'CH‚ÇÉ-CH‚ÇÇ-Cl', req:{C:2,H:5,Cl:1}, 
                guide: "L·∫•y 2 C, 5 H v√† 1 Cl. N·ªëi 2 C v·ªõi nhau. M·ªôt C g·∫Øn 3 H, C c√≤n l·∫°i g·∫Øn 2 H v√† 1 Cl.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng g·∫•p kh√∫c 2 ƒëo·∫°n. ƒê·∫ßu cu·ªëi ghi Cl.",
                quiz: [
                    {q: "T√™n g·ªëc-ch·ª©c c·ªßa C‚ÇÇH‚ÇÖCl l√†:", opt: ["Vinyl chloride", "Ethyl chloride", "Methyl chloride", "Propyl chloride"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma C-H trong ph√¢n t·ª≠:", opt: ["3", "4", "5", "6"], ans: 2},
                    {q: "T·ªïng s·ªë li√™n k·∫øt sigma trong C‚ÇÇH‚ÇÖCl:", opt: ["5", "6", "7", "8"], ans: 2},
                    {q: "Ph·∫£n ·ª©ng ƒë·∫∑c tr∆∞ng c·ªßa d·∫´n xu·∫•t halogen l√†:", opt: ["Ph·∫£n ·ª©ng th·∫ø nguy√™n t·ª≠ halogen", "Ph·∫£n ·ª©ng tr√°ng b·∫°c", "Ph·∫£n ·ª©ng tr√πng ng∆∞ng", "Ph·∫£n ·ª©ng m√†u biure"], ans: 0},
                    {q: "D√πng ƒë·ªÉ g√¢y t√™ c·ª•c b·ªô trong y h·ªçc:", opt: ["ƒê√∫ng", "Sai", "Ch∆∞a r√µ", "T√πy n·ªìng ƒë·ªô"], ans: 0}
                ]
            },
            'c6h6': { 
                n:'Benzene', f:'C‚ÇÜH‚ÇÜ', s:'V√≤ng l·ª•c gi√°c', req:{C:6,H:6}, 
                guide: "L·∫•y 6 C v√† 6 H. X·∫øp 6 C th√†nh v√≤ng l·ª•c gi√°c ƒë·ªÅu. V·∫Ω li√™n k·∫øt ƒë∆°n xen k·∫Ω li√™n k·∫øt ƒë√¥i (ho·∫∑c v√≤ng tr√≤n ·ªü gi·ªØa). M·ªói C g·∫Øn 1 H.",
                sk_guide: "V·∫Ω h√¨nh l·ª•c gi√°c ƒë·ªÅu. B√™n trong v·∫Ω v√≤ng tr√≤n (ho·∫∑c 3 g·∫°ch ƒë√¥i xen k·∫Ω) ƒë·ªÉ bi·ªÉu th·ªã h·ªá li√™n h·ª£p th∆°m.",
                quiz: [
                    {q: "C·∫•u tr√∫c c·ªßa Benzene l√† h√¨nh g√¨?", opt: ["Ng≈© gi√°c ƒë·ªÅu", "L·ª•c gi√°c ƒë·ªÅu", "H√¨nh vu√¥ng", "Tam gi√°c"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt pi (œÄ) trong v√≤ng Benzene ƒë∆∞·ª£c coi l√†:", opt: ["1", "2", "3", "4"], ans: 2},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong ph√¢n t·ª≠ C‚ÇÜH‚ÇÜ:", opt: ["6", "10", "12", "15"], ans: 2, expl: "6 C-C + 6 C-H = 12 sigma."},
                    {q: "T·∫•t c·∫£ c√°c nguy√™n t·ª≠ trong Benzene c√≥ c√πng n·∫±m tr√™n m·ªôt m·∫∑t ph·∫≥ng kh√¥ng?", opt: ["C√≥", "Kh√¥ng", "Ch·ªâ C n·∫±m tr√™n mp", "Ch·ªâ H n·∫±m tr√™n mp"], ans: 0},
                    {q: "G√≥c li√™n k·∫øt C-C-C trong v√≤ng Benzene l√†:", opt: ["90¬∞", "109.5¬∞", "120¬∞", "180¬∞"], ans: 2}
                ]
            },
            'c7h8': { 
                n:'Toluene', f:'C‚ÇáH‚Çà', s:'C‚ÇÜH‚ÇÖ-CH‚ÇÉ', req:{C:7,H:8}, 
                guide: "T·∫°o m·ªôt v√≤ng Benzen (6C, 5H). T·∫°i v·ªã tr√≠ C th·ª© 6, thay H b·∫±ng nh√≥m Methyl (-CH3).",
                sk_guide: "V·∫Ω v√≤ng l·ª•c gi√°c (nh√¢n th∆°m). T·ª´ m·ªôt ƒë·ªânh v·∫Ω th√™m m·ªôt g·∫°ch th·∫≥ng ra ngo√†i (nh√≥m Methyl).",
                quiz: [
                    {q: "T√™n thay th·∫ø c·ªßa Toluene l√†:", opt: ["Ethylbenzene", "Methylbenzene", "Vinylbenzene", "Propylbenzene"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong Toluene:", opt: ["12", "13", "14", "15"], ans: 3, expl: "12 (v√≤ng benzen tr·ª´ 1H) + 1 (lk C-C nh√°nh) + 3 (lk C-H nh√°nh) = 15."},
                    {q: "Toluene ph·∫£n ·ª©ng th·∫ø v√†o v√≤ng d·ªÖ hay kh√≥ h∆°n Benzene?", opt: ["Kh√≥ h∆°n", "D·ªÖ h∆°n", "Nh∆∞ nhau", "Kh√¥ng ph·∫£n ·ª©ng"], ans: 1},
                    {q: "V·ªã tr√≠ ∆∞u ti√™n th·∫ø tr√™n v√≤ng Toluene:", opt: ["Meta", "Ortho v√† Para", "Ch·ªâ Ortho", "Ch·ªâ Para"], ans: 1},
                    {q: "S·ªë nguy√™n t·ª≠ Carbon lai h√≥a sp¬≤ trong Toluene:", opt: ["6", "7", "5", "1"], ans: 0}
                ]
            },
            'c8h8': { 
                n:'Styrene', f:'C‚ÇàH‚Çà', s:'C‚ÇÜH‚ÇÖ-CH=CH‚ÇÇ', req:{C:8,H:8}, 
                guide: "T·∫°o v√≤ng Benzen. Thay m·ªôt H b·∫±ng nh√≥m Vinyl (-CH=CH2).",
                sk_guide: "V·∫Ω v√≤ng l·ª•c gi√°c th∆°m. G·∫Øn th√™m nh√≥m vinyl (2 g·∫°ch n·ªëi ƒë√¥i) v√†o m·ªôt ƒë·ªânh.",
                quiz: [
                    {q: "T√™n g·ªçi kh√°c c·ªßa Styrene l√†:", opt: ["Vinylbenzene", "Ethylbenzene", "Methylbenzene", "Allylbenzene"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt pi (œÄ) trong ph√¢n t·ª≠ Styrene:", opt: ["3", "4", "5", "1"], ans: 1, expl: "3 trong v√≤ng + 1 ngo√†i nh√°nh = 4 pi."},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong C‚ÇàH‚Çà:", opt: ["14", "15", "16", "17"], ans: 2},
                    {q: "Styrene c√≥ l√†m m·∫•t m√†u n∆∞·ªõc Brom kh√¥ng?", opt: ["C√≥", "Kh√¥ng", "Ch·ªâ khi ƒëun n√≥ng", "Ch·ªâ khi c√≥ x√∫c t√°c"], ans: 0},
                    {q: "Tr√πng h·ª£p Styrene thu ƒë∆∞·ª£c nh·ª±a:", opt: ["PE", "PP", "PS", "PVC"], ans: 2}
                ]
            },
            'ch3oh': { 
                n:'Methanol', f:'CH‚ÇÉOH', s:'CH‚ÇÉ-OH', req:{C:1,H:4,O:1}, 
                guide: "L·∫•y 1 C, 4 H, 1 O (ƒë·ªè). N·ªëi C v·ªõi O. G·∫Øn 3 H v√†o C v√† 1 H v√†o O (t·∫°o nh√≥m -OH).",
                sk_guide: "V·∫Ω m·ªôt g·∫°ch n·ªëi, cu·ªëi g·∫°ch ghi nh√≥m OH. (L∆∞u √Ω: Th∆∞·ªùng v·∫Ω CH3OH r√µ r√†ng thay v√¨ g·∫°ch tr∆°n).",
                quiz: [
                    {q: "Methanol l√† ch·∫•t l·ªèng, r·∫•t ƒë·ªôc, g√¢y m√π m·∫Øt ƒë√∫ng kh√¥ng?", opt: ["ƒê√∫ng", "Sai", "T√πy n·ªìng ƒë·ªô", "Kh√¥ng ƒë·ªôc"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong CH‚ÇÉOH:", opt: ["3", "4", "5", "6"], ans: 2, expl: "3 C-H + 1 C-O + 1 O-H = 5 sigma."},
                    {q: "B·∫≠c c·ªßa alcohol Methanol l√†:", opt: ["1", "2", "3", "Kh√¥ng ph√¢n b·∫≠c"], ans: 0},
                    {q: "Oxi h√≥a Methanol b·∫±ng CuO ƒëun n√≥ng t·∫°o ra:", opt: ["HCHO", "CH3CHO", "HCOOH", "CO2"], ans: 0},
                    {q: "Li√™n k·∫øt O-H ph√¢n c·ª±c v·ªÅ ph√≠a n√†o?", opt: ["Oxi", "Hydro", "Kh√¥ng ph√¢n c·ª±c", "Carbon"], ans: 0}
                ]
            },
            'c2h5oh': { 
                n:'Ethanol', f:'C‚ÇÇH‚ÇÖOH', s:'C‚ÇÇH‚ÇÖ-OH', req:{C:2,H:6,O:1}, 
                guide: "L·∫•y 2 C, 6 H, 1 O. N·ªëi C-C-O. G·∫Øn H ƒë·ªÉ t·∫°o nh√≥m CH3-CH2-OH.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng g·∫•p kh√∫c. ƒê·ªânh cu·ªëi c√πng n·ªëi v·ªõi nh√≥m OH.",
                quiz: [
                    {q: "Ethanol c√≤n ƒë∆∞·ª£c g·ªçi l√†:", opt: ["C·ªìn", "Gi·∫•m", "Ph√®n", "V√¥i"], ans: 0},
                    {q: "ƒê·ªô r∆∞·ª£u l√† g√¨?", opt: ["Kh·ªëi l∆∞·ª£ng r∆∞·ª£u/100g dd", "Th·ªÉ t√≠ch r∆∞·ª£u/100ml dd", "S·ªë mol r∆∞·ª£u/1 l√≠t", "Nhi·ªát ƒë·ªô s√¥i"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma (œÉ) trong C‚ÇÇH‚ÇÖOH:", opt: ["7", "8", "9", "10"], ans: 1},
                    {q: "Ethanol ph·∫£n ·ª©ng v·ªõi Na sinh ra kh√≠ g√¨?", opt: ["O‚ÇÇ", "H‚ÇÇ", "CO‚ÇÇ", "Cl‚ÇÇ"], ans: 1},
                    {q: "B·∫≠c c·ªßa alcohol Ethanol l√†:", opt: ["1", "2", "3", "4"], ans: 0}
                ]
            },
            'c6h5oh': { 
                n:'Phenol', f:'C‚ÇÜH‚ÇÖOH', s:'C‚ÇÜH‚ÇÖ-OH', req:{C:6,H:6,O:1}, 
                guide: "T·∫°o v√≤ng Benzen. Thay m·ªôt nguy√™n t·ª≠ H b·∫±ng nh√≥m -OH (Oxi ƒë·ªè n·ªëi v·ªõi H).",
                sk_guide: "V·∫Ω v√≤ng benzen (l·ª•c gi√°c + tr√≤n). N·ªëi m·ªôt ƒë·ªânh v·ªõi nh√≥m OH.",
                quiz: [
                    {q: "Phenol c√≥ t√≠nh ch·∫•t n√†o sau ƒë√¢y?", opt: ["Axit m·∫°nh", "Axit r·∫•t y·∫øu", "Baz∆° m·∫°nh", "Baz∆° y·∫øu"], ans: 1},
                    {q: "Hi·ªán t∆∞·ª£ng khi cho n∆∞·ªõc Brom v√†o dung d·ªãch Phenol:", opt: ["M·∫•t m√†u", "K·∫øt t·ªßa tr·∫Øng", "K·∫øt t·ªßa v√†ng", "Kh√¥ng hi·ªán t∆∞·ª£ng"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma trong ph√¢n t·ª≠ Phenol:", opt: ["12", "13", "14", "15"], ans: 1},
                    {q: "Phenol c√≥ l√†m ƒë·ªïi m√†u qu·ª≥ t√≠m kh√¥ng?", opt: ["H√≥a ƒë·ªè", "H√≥a xanh", "Kh√¥ng ƒë·ªïi m√†u", "M·∫•t m√†u"], ans: 2},
                    {q: "Nh√≥m OH li√™n k·∫øt tr·ª±c ti·∫øp v·ªõi v√≤ng Benzen ƒë∆∞·ª£c g·ªçi l√†:", opt: ["Alcohol th∆°m", "Phenol", "Ester", "Ete"], ans: 1}
                ]
            },
            'hcho': { 
                n:'Methanal', f:'HCHO', s:'H-CHO', req:{C:1,H:2,O:1}, 
                guide: "L·∫•y 1 C, 2 H, 1 O. N·ªëi C v·ªõi O b·∫±ng li√™n k·∫øt ƒê√îI. G·∫Øn 2 H v√†o C.",
                sk_guide: "V·∫Ω nh√≥m ch·ª©c CHO (th∆∞·ªùng ghi r√µ HCHO ho·∫∑c O=CH-H).",
                quiz: [
                    {q: "T√™n th√¥ng th∆∞·ªùng c·ªßa HCHO l√†:", opt: ["Fomon", "Andehit fomic", "C·∫£ A v√† B", "Acetone"], ans: 2},
                    {q: "S·ªë li√™n k·∫øt sigma trong HCHO:", opt: ["1", "2", "3", "4"], ans: 2},
                    {q: "S·ªë li√™n k·∫øt pi trong HCHO:", opt: ["0", "1", "2", "3"], ans: 1},
                    {q: "Ph·∫£n ·ª©ng tr√°ng g∆∞∆°ng c·ªßa 1 mol HCHO t·∫°o ra bao nhi√™u mol Ag?", opt: ["1", "2", "3", "4"], ans: 3},
                    {q: "Tr·∫°ng th√°i lai h√≥a c·ªßa C trong HCHO:", opt: ["sp", "sp¬≤", "sp¬≥", "Kh√¥ng lai h√≥a"], ans: 1}
                ]
            },
            'ch3cho': { 
                n:'Ethanal', f:'CH‚ÇÉCHO', s:'CH‚ÇÉ-CHO', req:{C:2,H:4,O:1}, 
                guide: "L·∫•y 2 C, 4 H, 1 O. T·∫°o nh√≥m -CHO ·ªü cu·ªëi m·∫°ch (C n·ªëi ƒë√¥i O v√† n·ªëi ƒë∆°n H). C c√≤n l·∫°i l√† nh√≥m CH3.",
                sk_guide: "V·∫Ω m·ªôt g·∫°ch n·ªëi, cu·ªëi g·∫°ch l√† nh√≥m CHO.",
                quiz: [
                    {q: "T√™n g·ªçi kh√°c c·ªßa Ethanal:", opt: ["Andehit axetic", "Andehit fomic", "Axeton", "Metanol"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong CH‚ÇÉCHO:", opt: ["4", "5", "6", "7"], ans: 2},
                    {q: "Nh√≥m ch·ª©c c·ªßa andehit l√†:", opt: ["-COOH", "-OH", "-CHO", "-COO-"], ans: 2},
                    {q: "Ph·∫£n ·ª©ng tr√°ng g∆∞∆°ng c·ªßa 1 mol CH‚ÇÉCHO t·∫°o ra bao nhi√™u mol Ag?", opt: ["1", "2", "4", "6"], ans: 1},
                    {q: "Oxi h√≥a Ethanal thu ƒë∆∞·ª£c:", opt: ["Ethanol", "Acid ethanoic", "Ethene", "CO2"], ans: 1}
                ]
            },
            'hcooh': { 
                n:'Methanoic Acid', f:'HCOOH', s:'H-COOH', req:{C:1,H:2,O:2}, 
                guide: "L·∫•y 1 C, 2 H, 2 O. M·ªôt O n·ªëi ƒë√¥i v·ªõi C. O c√≤n l·∫°i n·ªëi ƒë∆°n v·ªõi C v√† g·∫Øn v·ªõi H (nh√≥m -COOH).",
                sk_guide: "V·∫Ω nh√≥m ch·ª©c COOH (th∆∞·ªùng ghi r√µ HCOOH).",
                quiz: [
                    {q: "T√™n th√¥ng th∆∞·ªùng c·ªßa HCOOH l√†:", opt: ["Axit axetic", "Axit fomic", "Axit propionic", "Gi·∫•m ƒÉn"], ans: 1},
                    {q: "Axit fomic c√≥ trong n·ªçc c·ªßa lo√†i n√†o?", opt: ["Ong", "Ki·∫øn", "C·∫£ A v√† B", "R·∫Øn"], ans: 2},
                    {q: "S·ªë li√™n k·∫øt pi trong ph√¢n t·ª≠ HCOOH:", opt: ["0", "1", "2", "3"], ans: 1},
                    {q: "HCOOH c√≥ tham gia ph·∫£n ·ª©ng tr√°ng b·∫°c kh√¥ng?", opt: ["C√≥", "Kh√¥ng", "T√πy ƒëi·ªÅu ki·ªán", "Ch·ªâ v·ªõi Cu(OH)2"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong HCOOH:", opt: ["3", "4", "5", "6"], ans: 1, expl: "1 C-H + 1 C=O(sigma) + 1 C-O + 1 O-H = 4 sigma."}
                ]
            },
            'ch3cooh': { 
                n:'Ethanoic Acid', f:'CH‚ÇÉCOOH', s:'CH‚ÇÉ-COOH', req:{C:2,H:4,O:2}, 
                guide: "L·∫•y 2 C, 4 H, 2 O. T·∫°o nh√≥m -COOH ·ªü m·ªôt C. C c√≤n l·∫°i l√† nh√≥m CH3.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng g·∫•p kh√∫c. ƒê·ªânh cu·ªëi g·∫Øn nh√≥m OOH ho·∫∑c v·∫Ω r√µ -COOH.",
                quiz: [
                    {q: "Dung d·ªãch CH‚ÇÉCOOH 2-5% ƒë∆∞·ª£c g·ªçi l√†:", opt: ["C·ªìn", "Gi·∫•m ƒÉn", "N∆∞·ªõc v√¥i", "Formalin"], ans: 1},
                    {q: "C√¥ng th·ª©c t·ªïng qu√°t c·ªßa axit cacboxylic no, ƒë∆°n ch·ª©c, m·∫°ch h·ªü:", opt: ["CnH2nO2", "CnH2n+2O", "CnH2n-2O2", "CnH2nO"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong CH‚ÇÉCOOH:", opt: ["6", "7", "8", "9"], ans: 1},
                    {q: "CH‚ÇÉCOOH l√†m qu·ª≥ t√≠m chuy·ªÉn m√†u g√¨?", opt: ["Xanh", "ƒê·ªè", "T√≠m", "Kh√¥ng m√†u"], ans: 1},
                    {q: "Ph·∫£n ·ª©ng gi·ªØa axit v√† ancol g·ªçi l√† ph·∫£n ·ª©ng:", opt: ["X√† ph√≤ng h√≥a", "Este h√≥a", "Tr√πng h·ª£p", "Th·ªßy ph√¢n"], ans: 1}
                ]
            },
            'c3h6o2': { 
                n:'Methyl Acetate', f:'C‚ÇÉH‚ÇÜO‚ÇÇ', s:'CH‚ÇÉCOO-CH‚ÇÉ', req:{C:3,H:6,O:2}, 
                guide: "L·∫•y 3 C, 6 H, 2 O. T·∫°o nh√≥m ch·ª©c este -COO- ·ªü gi·ªØa. M·ªôt b√™n l√† CH3, b√™n kia c≈©ng l√† CH3.",
                sk_guide: "V·∫Ω nh√≥m ch·ª©c este COO ·ªü gi·ªØa m·∫°ch.",
                quiz: [
                    {q: "Methyl Acetate l√† h·ª£p ch·∫•t thu·ªôc lo·∫°i:", opt: ["Axit", "Este", "Ancol", "Andehit"], ans: 1},
                    {q: "M√πi ƒë·∫∑c tr∆∞ng c·ªßa c√°c este th∆∞·ªùng l√†:", opt: ["H·∫Øc", "Th∆°m hoa qu·∫£", "Khai", "Tanh"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt pi trong ph√¢n t·ª≠ Methyl Acetate:", opt: ["0", "1", "2", "3"], ans: 1},
                    {q: "Ph·∫£n ·ª©ng th·ªßy ph√¢n este trong m√¥i tr∆∞·ªùng ki·ªÅm g·ªçi l√†:", opt: ["Este h√≥a", "X√† ph√≤ng h√≥a", "Tr√πng ng∆∞ng", "Hydrat h√≥a"], ans: 1},
                    {q: "S·ªë ƒë·ªìng ph√¢n este ·ª©ng v·ªõi c√¥ng th·ª©c C3H6O2:", opt: ["1", "2", "3", "4"], ans: 1}
                ]
            },
            'c4h8o2': { 
                n:'Ethyl Acetate', f:'C‚ÇÑH‚ÇàO‚ÇÇ', s:'CH‚ÇÉCOO-C‚ÇÇH‚ÇÖ', req:{C:4,H:8,O:2}, 
                guide: "L·∫•y 4 C, 8 H, 2 O. C·∫•u tr√∫c l√† CH3-COO-CH2-CH3. Ch√∫ √Ω nh√≥m ch·ª©c este n·ªëi 2 g·ªëc hydrocarbon.",
                sk_guide: "V·∫Ω m·∫°ch C, ch√®n nh√≥m COO v√†o v·ªã tr√≠ th√≠ch h·ª£p.",
                quiz: [
                    {q: "T√™n g·ªçi c·ªßa este CH‚ÇÉCOOC‚ÇÇH‚ÇÖ l√†:", opt: ["Metyl axetat", "Etyl axetat", "Propyl axetat", "Etyl fomat"], ans: 1},
                    {q: "T·ªïng s·ªë nguy√™n t·ª≠ trong ph√¢n t·ª≠ Ethyl Acetate:", opt: ["12", "13", "14", "15"], ans: 2},
                    {q: "S·ªë li√™n k·∫øt sigma trong C‚ÇÑH‚ÇàO‚ÇÇ (ƒë∆°n ch·ª©c):", opt: ["11", "12", "13", "14"], ans: 2},
                    {q: "Ethyl acetate th∆∞·ªùng d√πng l√†m:", opt: ["Dung m√¥i", "Th·ª±c ph·∫©m", "Thu·ªëc n·ªï", "Ph√¢n b√≥n"], ans: 0},
                    {q: "S·∫£n ph·∫©m th·ªßy ph√¢n Ethyl acetate trong NaOH l√†:", opt: ["CH3COOH + C2H5OH", "CH3COONa + C2H5OH", "HCOONa + C3H7OH", "CH3OH + C2H5COOH"], ans: 1}
                ]
            },
            'ch5n': { 
                n:'Methylamine', f:'CH‚ÇÖN', s:'CH‚ÇÉ-NH‚ÇÇ', req:{C:1,H:5,N:1}, 
                guide: "L·∫•y 1 C, 1 N (xanh d∆∞∆°ng), 5 H. N·ªëi C v·ªõi N. C g·∫Øn 3 H, N g·∫Øn 2 H.",
                sk_guide: "V·∫Ω m·ªôt g·∫°ch n·ªëi, cu·ªëi l√† nh√≥m NH2.",
                quiz: [
                    {q: "Methylamine l√† ch·∫•t ·ªü tr·∫°ng th√°i n√†o ƒëi·ªÅu ki·ªán th∆∞·ªùng?", opt: ["R·∫Øn", "L·ªèng", "Kh√≠", "Plasma"], ans: 2},
                    {q: "Dung d·ªãch Methylamine l√†m qu·ª≥ t√≠m h√≥a:", opt: ["ƒê·ªè", "Xanh", "Kh√¥ng ƒë·ªïi", "M·∫•t m√†u"], ans: 1},
                    {q: "B·∫≠c c·ªßa amin Methylamine l√†:", opt: ["1", "2", "3", "4"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong ph√¢n t·ª≠ CH5N:", opt: ["4", "5", "6", "7"], ans: 2},
                    {q: "M√πi ƒë·∫∑c tr∆∞ng c·ªßa c√°c amin kh√≠ l√†:", opt: ["Th∆°m", "H·∫Øc", "Khai", "Tanh"], ans: 2}
                ]
            },
            'c2h7n': { 
                n:'Ethylamine', f:'C‚ÇÇH‚ÇáN', s:'C‚ÇÇH‚ÇÖ-NH‚ÇÇ', req:{C:2,H:7,N:1}, 
                guide: "L·∫•y 2 C, 1 N, 7 H. T·∫°o m·∫°ch C-C-N. B·ªï sung H cho ƒë·ªß h√≥a tr·ªã.",
                sk_guide: "V·∫Ω ƒë∆∞·ªùng g·∫•p kh√∫c, cu·ªëi m·∫°ch g·∫Øn nh√≥m NH2.",
                quiz: [
                    {q: "C√¥ng th·ª©c c·ªßa Ethylamine l√†:", opt: ["CH3NH2", "C2H5NH2", "C3H7NH2", "C6H5NH2"], ans: 1},
                    {q: "Ethylamine t√°c d·ª•ng v·ªõi HCl t·∫°o th√†nh:", opt: ["Mu·ªëi", "Base", "Acid", "Ancol"], ans: 0},
                    {q: "S·ªë li√™n k·∫øt sigma trong C2H7N:", opt: ["8", "9", "10", "11"], ans: 1},
                    {q: "B·∫≠c c·ªßa amin Ethylamine:", opt: ["1", "2", "3", "4"], ans: 0},
                    {q: "So s√°nh t√≠nh baz∆°: C2H5NH2 ... NH3", opt: ["M·∫°nh h∆°n", "Y·∫øu h∆°n", "B·∫±ng nhau", "Kh√¥ng so s√°nh ƒë∆∞·ª£c"], ans: 0}
                ]
            },
            'c4h11n': { 
                n:'Diethylamine', f:'C‚ÇÑH‚ÇÅ‚ÇÅN', s:'(C‚ÇÇH‚ÇÖ)‚ÇÇNH', req:{C:4,H:11,N:1}, 
                guide: "L·∫•y 4 C, 1 N, 11 H. N ·ªü gi·ªØa, hai b√™n l√† 2 nh√≥m Ethyl (C2H5). N c√≤n g·∫Øn 1 H.",
                sk_guide: "V·∫Ω ch·ªØ V v·ªõi ƒë√°y l√† NH, hai nh√°nh l√† ethyl.",
                quiz: [
                    {q: "Diethylamine l√† amin b·∫≠c m·∫•y?", opt: ["1", "2", "3", "4"], ans: 1},
                    {q: "S·ªë nguy√™n t·ª≠ H trong ph√¢n t·ª≠:", opt: ["9", "10", "11", "12"], ans: 2},
                    {q: "T√≠nh baz∆° c·ªßa amin b·∫≠c 2 m·∫°ch h·ªü th∆∞·ªùng ... b·∫≠c 1 t∆∞∆°ng ·ª©ng.", opt: ["Y·∫øu h∆°n", "M·∫°nh h∆°n", "B·∫±ng", "Kh√°c"], ans: 1},
                    {q: "C√¥ng th·ª©c t·ªïng qu√°t amin no, ƒë∆°n ch·ª©c, m·∫°ch h·ªü:", opt: ["CnH2n+1N", "CnH2n+3N", "CnH2nN", "CnH2n-1N"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma C-C trong Diethylamine:", opt: ["1", "2", "3", "4"], ans: 1}
                ]
            },
            'c3h9n': { 
                n:'Trimethylamine', f:'C‚ÇÉH‚ÇâN', s:'(CH‚ÇÉ)‚ÇÉN', req:{C:3,H:9,N:1}, 
                guide: "L·∫•y 3 C, 1 N, 9 H. N ·ªü trung t√¢m, n·ªëi v·ªõi 3 nh√≥m Methyl (CH3) xung quanh.",
                sk_guide: "V·∫Ω 3 g·∫°ch xu·∫•t ph√°t t·ª´ ch·ªØ N trung t√¢m.",
                quiz: [
                    {q: "B·∫≠c c·ªßa amin Trimethylamine:", opt: ["1", "2", "3", "4"], ans: 2},
                    {q: "Tr·∫°ng th√°i lai h√≥a c·ªßa N trong amin:", opt: ["sp", "sp¬≤", "sp¬≥", "dsp¬≤"], ans: 2},
                    {q: "H√¨nh h·ªçc ph√¢n t·ª≠ quanh N:", opt: ["Tam gi√°c ph·∫≥ng", "Th√°p tam gi√°c", "T·ª© di·ªán ƒë·ªÅu", "ƒê∆∞·ªùng th·∫≥ng"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma trong ph√¢n t·ª≠:", opt: ["10", "11", "12", "13"], ans: 2},
                    {q: "C√≥ bao nhi√™u nh√≥m Methyl li√™n k·∫øt v·ªõi N?", opt: ["1", "2", "3", "4"], ans: 2}
                ]
            },
            'c6h7n': { 
                n:'Aniline', f:'C‚ÇÜH‚ÇáN', s:'C‚ÇÜH‚ÇÖ-NH‚ÇÇ', req:{C:6,H:7,N:1}, 
                guide: "T·∫°o v√≤ng Benzen. Thay m·ªôt H b·∫±ng nh√≥m Amino (-NH2).",
                sk_guide: "V·∫Ω v√≤ng benzen g·∫Øn nh√≥m NH2.",
                quiz: [
                    {q: "Aniline c√≥ t√≠nh baz∆°:", opt: ["M·∫°nh", "Y·∫øu", "R·∫•t m·∫°nh", "Trung b√¨nh"], ans: 1},
                    {q: "Aniline c√≥ l√†m xanh qu·ª≥ t√≠m kh√¥ng?", opt: ["C√≥", "Kh√¥ng", "L√†m ƒë·ªè", "M·∫•t m√†u"], ans: 1},
                    {q: "Ph·∫£n ·ª©ng nh·∫≠n bi·∫øt Aniline:", opt: ["T√°c d·ª•ng v·ªõi n∆∞·ªõc Brom", "T√°c d·ª•ng v·ªõi HCl", "Tr√°ng g∆∞∆°ng", "ƒê·ªët ch√°y"], ans: 0},
                    {q: "Hi·ªán t∆∞·ª£ng ph·∫£n ·ª©ng v·ªõi n∆∞·ªõc Brom:", opt: ["K·∫øt t·ªßa v√†ng", "K·∫øt t·ªßa tr·∫Øng", "Kh√≠ bay ra", "Dung d·ªãch xanh"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt pi trong ph√¢n t·ª≠ Aniline:", opt: ["3", "4", "5", "6"], ans: 0}
                ]
            },
            'c2h5no2': { 
                n:'Glycine', f:'C‚ÇÇH‚ÇÖNO‚ÇÇ', s:'H‚ÇÇN-CH‚ÇÇ-COOH', req:{C:2,H:5,N:1,O:2}, 
                guide: "Amino axit ƒë∆°n gi·∫£n nh·∫•t. C trung t√¢m g·∫Øn v·ªõi: 1 nh√≥m -NH2, 1 nh√≥m -COOH v√† 2 H.",
                sk_guide: "V·∫Ω m·∫°ch ch√≠nh 2C, m·ªôt ƒë·∫ßu l√† NH2, m·ªôt ƒë·∫ßu l√† COOH.",
                quiz: [
                    {q: "T√™n g·ªçi kh√°c c·ªßa Glycine:", opt: ["Axit aminoaxetic", "Alanin", "Valin", "Lysin"], ans: 0},
                    {q: "Glycine l√† ch·∫•t r·∫Øn, d·∫°ng tinh th·ªÉ, v·ªã:", opt: ["Chua", "Ng·ªçt", "M·∫∑n", "ƒê·∫Øng"], ans: 1},
                    {q: "Glycine c√≥ t√≠nh ch·∫•t:", opt: ["Axit", "Baz∆°", "L∆∞·ª°ng t√≠nh", "Trung t√≠nh"], ans: 2},
                    {q: "Kh·ªëi l∆∞·ª£ng ph√¢n t·ª≠ c·ªßa Glycine:", opt: ["75", "89", "117", "146"], ans: 0},
                    {q: "Glycine c√≥ l√†m ƒë·ªïi m√†u qu·ª≥ t√≠m kh√¥ng?", opt: ["H√≥a ƒë·ªè", "H√≥a xanh", "Kh√¥ng ƒë·ªïi m√†u", "M·∫•t m√†u"], ans: 2}
                ]
            },
            'c3h7no2': { 
                n:'Alanine', f:'C‚ÇÉH‚ÇáNO‚ÇÇ', s:'CH‚ÇÉ-CH(NH‚ÇÇ)-COOH', req:{C:3,H:7,N:1,O:2}, 
                guide: "Gi·ªëng Glycine nh∆∞ng thay m·ªôt H ·ªü C trung t√¢m b·∫±ng nh√≥m Methyl (-CH3).",
                sk_guide: "V·∫Ω m·∫°ch 3C, ·ªü C s·ªë 2 (alpha) g·∫Øn nh√≥m NH2, C s·ªë 1 l√† COOH.",
                quiz: [
                    {q: "Alanine c√≥ m·∫•y nguy√™n t·ª≠ Carbon?", opt: ["2", "3", "4", "5"], ans: 1},
                    {q: "T√™n b√°n h·ªá th·ªëng c·ªßa Alanine:", opt: ["Axit alpha-aminopropionic", "Axit beta-aminopropionic", "Axit aminoaxetic", "Axit glutamic"], ans: 0},
                    {q: "Alanine c√≥ t√≠nh l∆∞·ª°ng t√≠nh kh√¥ng?", opt: ["C√≥", "Kh√¥ng", "Ch·ªâ t√≠nh axit", "Ch·ªâ t√≠nh baz∆°"], ans: 0},
                    {q: "Kh·ªëi l∆∞·ª£ng ph√¢n t·ª≠ c·ªßa Alanine:", opt: ["75", "89", "117", "146"], ans: 1},
                    {q: "S·ªë li√™n k·∫øt sigma trong Alanine:", opt: ["10", "11", "12", "13"], ans: 2}
                ]
            },
            'c5h11no2': { 
                n:'Valine', f:'C‚ÇÖH‚ÇÅ‚ÇÅNO‚ÇÇ', s:'(CH‚ÇÉ)‚ÇÇCH-CH(NH‚ÇÇ)-COOH', req:{C:5,H:11,N:1,O:2}, 
                guide: "C·∫•u tr√∫c amino axit v·ªõi nh√≥m th·∫ø Isopropyl (ch·ªØ V ng∆∞·ª£c). M·∫°ch ch√≠nh: NH2-CH(R)-COOH.",
                sk_guide: "M·∫°ch ch√≠nh, nh√°nh isopropyl ·ªü v·ªã tr√≠ alpha ho·∫∑c beta t√πy danh ph√°p, nh∆∞ng Valine c√≥ nh√°nh isopropyl ·ªü C alpha.",
                quiz: [
                    {q: "Valine c√≥ ph√¢n t·ª≠ kh·ªëi l√†:", opt: ["89", "117", "146", "75"], ans: 1},
                    {q: "S·ªë nguy√™n t·ª≠ C trong Valine:", opt: ["4", "5", "6", "7"], ans: 1},
                    {q: "T√™n thay th·∫ø c·ªßa Valine:", opt: ["Axit 2-amino-3-metylbutanoic", "Axit 2-aminopentanoic", "Axit aminoaxetic", "Axit glutamic"], ans: 0},
                    {q: "Valine l√† m·ªôt amino axit thi·∫øt y·∫øu:", opt: ["ƒê√∫ng", "Sai", "Ch∆∞a r√µ", "T√πy c∆° ƒë·ªãa"], ans: 0},
                    {q: "S·ªë nh√≥m -NH2 v√† -COOH trong Valine:", opt: ["1-1", "1-2", "2-1", "2-2"], ans: 0}
                ]
            },
            'c6h14n2o2': { 
                n:'Lysine', f:'C‚ÇÜH‚ÇÅ‚ÇÑN‚ÇÇO‚ÇÇ', s:'H‚ÇÇN-(CH‚ÇÇ)‚ÇÑ-CH(NH‚ÇÇ)-COOH', req:{C:6,H:14,N:2,O:2}, 
                guide: "C√≥ 2 nh√≥m Amino (-NH2). M·ªôt nh√≥m ·ªü v·ªã tr√≠ alpha, m·ªôt nh√≥m ·ªü cu·ªëi m·∫°ch carbon d√†i 4C.",
                sk_guide: "M·∫°ch C d√†i, 2 nh√≥m NH2 ·ªü hai v·ªã tr√≠ kh√°c nhau.",
                quiz: [
                    {q: "Lysine c√≥ bao nhi√™u nh√≥m NH2?", opt: ["1", "2", "3", "4"], ans: 1},
                    {q: "Lysine l√†m qu·ª≥ t√≠m chuy·ªÉn m√†u:", opt: ["ƒê·ªè", "Xanh", "T√≠m", "V√†ng"], ans: 1},
                    {q: "Kh·ªëi l∆∞·ª£ng ph√¢n t·ª≠ c·ªßa Lysine:", opt: ["117", "146", "147", "89"], ans: 1},
                    {q: "Lysine c√≥ t√≠nh ch·∫•t:", opt: ["Axit m·∫°nh", "Baz∆° m·∫°nh", "L∆∞·ª°ng t√≠nh", "Trung t√≠nh"], ans: 2},
                    {q: "S·ªë nguy√™n t·ª≠ N trong Lysine:", opt: ["1", "2", "3", "4"], ans: 1}
                ]
            },
            'c5h9no4': { 
                n:'Glutamic Acid', f:'C‚ÇÖH‚ÇâNO‚ÇÑ', s:'HOOC-CH‚ÇÇ-CH‚ÇÇ-CH(NH‚ÇÇ)-COOH', req:{C:5,H:9,N:1,O:4}, 
                guide: "C√≥ 2 nh√≥m Axit (-COOH). M·ªôt nh√≥m ·ªü ƒë·∫ßu, m·ªôt nh√≥m ·ªü cu·ªëi m·∫°ch. Nh√≥m Amino ·ªü v·ªã tr√≠ alpha.",
                sk_guide: "M·∫°ch 5C, 2 nh√≥m COOH ·ªü 2 ƒë·∫ßu, 1 nh√≥m NH2 ·ªü v·ªã tr√≠ alpha.",
                quiz: [
                    {q: "Axit glutamic c√≥ bao nhi√™u nh√≥m COOH?", opt: ["1", "2", "3", "4"], ans: 1},
                    {q: "Dung d·ªãch Axit glutamic l√†m qu·ª≥ t√≠m h√≥a:", opt: ["Xanh", "ƒê·ªè", "H·ªìng", "T√≠m"], ans: 2},
                    {q: "Mu·ªëi mononatri c·ªßa axit glutamic d√πng l√†m:", opt: ["B·ªôt ng·ªçt (m√¨ ch√≠nh)", "Thu·ªëc n·ªï", "Ph√¢n b√≥n", "X√† ph√≤ng"], ans: 0},
                    {q: "Kh·ªëi l∆∞·ª£ng ph√¢n t·ª≠ c·ªßa Axit glutamic:", opt: ["146", "147", "117", "89"], ans: 1},
                    {q: "S·ªë nguy√™n t·ª≠ Oxi trong ph√¢n t·ª≠:", opt: ["2", "3", "4", "5"], ans: 2}
                ]
            }
        };

        let curKey = 'ch4';
        let atomId = 0;
        let score = 0;
        const ws = document.getElementById('workspace');
        const bondSvg = document.getElementById('bond-layer');
        let bonds = [];
        let isDraw = false;
        let isDrawingBond = false;
        let startAtom = null;
        let tempLine = null;

        // --- MUSIC LOGIC ---
        const bgAudio = document.getElementById('bgAudio');
        const btnPlayMusic = document.getElementById('btnPlayMusic');

        function handleMusicFile(input) {
            const file = input.files[0];
            if (file) {
                bgAudio.src = URL.createObjectURL(file);
                bgAudio.play();
                btnPlayMusic.innerHTML = "‚è∏Ô∏è T·∫Øt";
                notify("üéµ ƒêang ph√°t: " + file.name, true);
            }
        }

        function toggleMusic() {
            if (!bgAudio.src) { notify("‚ö†Ô∏è H√£y m·ªü file nh·∫°c tr∆∞·ªõc!", false); return; }
            if (bgAudio.paused) { bgAudio.play(); btnPlayMusic.innerHTML = "‚è∏Ô∏è T·∫Øt"; } 
            else { bgAudio.pause(); btnPlayMusic.innerHTML = "‚ñ∂Ô∏è B·∫≠t"; }
        }

        function toggleProp(el) {
            const isOpen = el.classList.contains('active');
            document.querySelectorAll('.prop-box').forEach(b => { b.classList.remove('active'); });
            if (!isOpen) { el.classList.add('active'); }
        }

        function getSkeletonSVG(key) {
            const svgStart = '<svg viewBox="0 0 200 150" xmlns="http://www.w3.org/2000/svg" style="width:100%; height:auto;">';
            const svgEnd = '</svg>';
            const style = `<style>
                .bond { stroke: #333; stroke-width: 3; fill: none; stroke-linecap: round; stroke-linejoin: round; }
                .text { font-family: Arial, sans-serif; font-size: 24px; fill: #333; font-weight: bold; text-anchor: middle; dominant-baseline: middle;}
                .sub { font-size: 16px; baseline-shift: sub; }
            </style>`;

            let content = '';
            // Basic logic for SVG generation (Same as before but ensures coverage)
            switch(key) {
                case 'ch4': content = `<text x="100" y="75" class="text">CH<tspan class="sub">4</tspan></text>`; break;
                case 'c2h6': content = `<line x1="50" y1="75" x2="150" y2="75" class="bond" />`; break;
                case 'c3h8': content = `<polyline points="40,100 100,50 160,100" class="bond" />`; break;
                case 'c2h4': content = `<line x1="50" y1="65" x2="150" y2="65" class="bond" /><line x1="50" y1="85" x2="150" y2="85" class="bond" />`; break;
                case 'c3h6': content = `<line x1="40" y1="90" x2="100" y2="40" class="bond" /><line x1="48" y1="100" x2="98" y2="58" class="bond" /><line x1="100" y1="50" x2="160" y2="100" class="bond" />`; break;
                case 'c2h2': content = `<line x1="50" y1="60" x2="150" y2="60" class="bond" /><line x1="50" y1="75" x2="150" y2="75" class="bond" /><line x1="50" y1="90" x2="150" y2="90" class="bond" />`; break;
                case 'c3h4': content = `<line x1="40" y1="100" x2="100" y2="100" class="bond" /><line x1="40" y1="90" x2="100" y2="90" class="bond" /><line x1="40" y1="110" x2="100" y2="110" class="bond" /><line x1="100" y1="100" x2="160" y2="100" class="bond" />`; break;
                case 'ch3cl': content = `<line x1="80" y1="75" x2="120" y2="75" class="bond" /><text x="140" y="75" class="text" style="text-anchor: start;">Cl</text>`; break;
                case 'c2h5cl': content = `<polyline points="40,100 100,50 130,75" class="bond" /><text x="145" y="85" class="text" style="text-anchor: start;">Cl</text>`; break;
                case 'c6h6': content = `<polygon points="100,20 143,45 143,95 100,120 57,95 57,45" class="bond" /><circle cx="100" cy="70" r="25" class="bond" style="stroke-width:2;" />`; break;
                case 'c7h8': content = `<polygon points="100,40 135,60 135,100 100,120 65,100 65,60" class="bond" /><circle cx="100" cy="80" r="20" class="bond" style="stroke-width:2;" /><line x1="100" y1="40" x2="100" y2="10" class="bond" />`; break;
                case 'c8h8': content = `<polygon points="80,50 108,66 108,98 80,114 52,98 52,66" class="bond" /><circle cx="80" cy="82" r="16" class="bond" style="stroke-width:2;" /><line x1="108" y1="66" x2="140" y2="48" class="bond" /><line x1="140" y1="48" x2="170" y2="65" class="bond" /><line x1="144" y1="42" x2="174" y2="59" class="bond" />`; break;
                case 'ch3oh': content = `<line x1="80" y1="75" x2="110" y2="75" class="bond" /><text x="130" y="78" class="text" style="text-anchor: start;">OH</text>`; break;
                case 'c2h5oh': content = `<polyline points="40,100 90,50 120,80" class="bond" /><text x="130" y="95" class="text" style="text-anchor: start;">OH</text>`; break;
                case 'c6h5oh': content = `<polygon points="100,40 135,60 135,100 100,120 65,100 65,60" class="bond" /><circle cx="100" cy="80" r="20" class="bond" style="stroke-width:2;" /><line x1="100" y1="40" x2="100" y2="15" class="bond" /><text x="100" y="5" class="text" style="font-size: 20px;">OH</text>`; break;
                case 'hcho': content = `<line x1="80" y1="75" x2="110" y2="55" class="bond" /><line x1="80" y1="75" x2="110" y2="95" class="bond" /><line x1="77" y1="70" x2="107" y2="50" class="bond" /><text x="125" y="55" class="text" style="text-anchor: start;">O</text>`; break;
                case 'ch3cho': content = `<line x1="40" y1="90" x2="90" y2="50" class="bond" /><line x1="90" y1="50" x2="120" y2="65" class="bond" /><line x1="90" y1="50" x2="118" y2="30" class="bond" /><line x1="94" y1="48" x2="122" y2="28" class="bond" /><text x="130" y="30" class="text" style="text-anchor: start;">O</text>`; break;
                case 'hcooh': content = `<line x1="80" y1="80" x2="110" y2="60" class="bond" /><line x1="77" y1="75" x2="107" y2="55" class="bond" /><text x="120" y="55" class="text" style="text-anchor: start;">O</text><line x1="80" y1="80" x2="110" y2="100" class="bond" /><text x="120" y="110" class="text" style="text-anchor: start;">OH</text>`; break;
                case 'ch3cooh': content = `<line x1="40" y1="90" x2="90" y2="50" class="bond" /><line x1="90" y1="50" x2="115" y2="30" class="bond" /><line x1="94" y1="55" x2="119" y2="35" class="bond" /><text x="125" y="35" class="text" style="text-anchor: start;">O</text><line x1="90" y1="50" x2="115" y2="80" class="bond" /><text x="125" y="90" class="text" style="text-anchor: start;">OH</text>`; break;
                case 'c3h6o2': content = `<polyline points="20,100 60,60 90,80 130,50" class="bond" /><line x1="60" y1="60" x2="75" y2="35" class="bond" /><line x1="56" y1="58" x2="71" y2="33" class="bond" /><text x="75" y="30" class="text" style="text-anchor: start;">O</text><text x="90" y="80" class="text" style="font-size: 20px; fill:#333; background:white;">O</text>`; break;
                default: content = `<text x="100" y="75" class="text">${key.toUpperCase()}</text>`;
            }
            return svgStart + style + content + svgEnd;
        }

        // --- QUIZ RENDERING LOGIC ---
        function renderQuiz() {
            const quizData = db[curKey].quiz || [];
            const container = document.getElementById('quizContent');
            container.innerHTML = '';

            if (quizData.length === 0) {
                container.innerHTML = "<div>Ch∆∞a c√≥ d·ªØ li·ªáu tr·∫Øc nghi·ªám cho ch·∫•t n√†y.</div>";
                return;
            }

            quizData.forEach((q, idx) => {
                const qDiv = document.createElement('div');
                qDiv.className = 'quiz-container';
                
                const qTitle = document.createElement('div');
                qTitle.className = 'quiz-question';
                qTitle.innerHTML = `C√¢u ${idx+1}: ${q.q}`;
                qDiv.appendChild(qTitle);

                const optsDiv = document.createElement('div');
                optsDiv.className = 'quiz-options';

                q.opt.forEach((optText, i) => {
                    const btn = document.createElement('button');
                    btn.className = 'quiz-btn';
                    btn.innerText = ["A", "B", "C", "D"][i] + ". " + optText;
                    btn.onclick = () => checkQuiz(btn, q, i, optsDiv);
                    optsDiv.appendChild(btn);
                });
                qDiv.appendChild(optsDiv);

                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'quiz-feedback';
                feedbackDiv.id = `feedback-${idx}`;
                qDiv.appendChild(feedbackDiv);

                container.appendChild(qDiv);
                if(idx < quizData.length -1) container.appendChild(document.createElement('hr'));
            });
        }

        function checkQuiz(btn, question, chosenIdx, container) {
            // Disable all buttons in this question
            const allBtns = container.querySelectorAll('.quiz-btn');
            allBtns.forEach(b => b.disabled = true);

            const feedback = container.nextElementSibling;

            if (chosenIdx === question.ans) {
                btn.classList.add('correct');
                feedback.innerHTML = `<span style="color:#2e7d32">‚úÖ Ch√≠nh x√°c! +20 Kim c∆∞∆°ng. ${question.expl ? '<br>'+question.expl : ''}</span>`;
                addDiamonds(20);
                confetti({ particleCount: 50, spread: 60, origin: { y: 0.6 } });
            } else {
                btn.classList.add('wrong');
                // Highlight correct answer
                allBtns[question.ans].classList.add('correct');
                feedback.innerHTML = `<span style="color:#c62828">‚ùå Sai r·ªìi. ƒê√°p √°n ƒë√∫ng l√†: ${["A","B","C","D"][question.ans]}.</span>`;
            }
        }

        function addDiamonds(amount) {
            diamonds += amount;
            diamondEl.innerText = diamonds;
            diamondEl.parentElement.style.transform = "scale(1.2)";
            setTimeout(() => diamondEl.parentElement.style.transform = "scale(1)", 200);
        }

        function changeTask() {
            const sel = document.getElementById('compoundSelect');
            if (!sel) return; 
            curKey = sel.value;
            const d = db[curKey];
            
            document.getElementById('taskFormula').innerText = d.f;
            document.getElementById('propStruct').innerText = d.s;
            document.getElementById('propGuide').innerText = d.guide;
            
            // Hide Reference Skeleton when changing tasks and ensure the main view is hidden initially
            // REMOVED referenceSkeleton because it was removed from DOM in previous step
            const skelView = document.getElementById('main-skeleton-view');
            if (skelView) {
                skelView.style.display = 'none';
            }

            // Render Skeletal Guide in the right panel
            document.getElementById('skeletalGuide').innerText = "üí° Nguy√™n t·∫Øc v·∫Ω: " + (d.sk_guide || "ƒêang c·∫≠p nh·∫≠t...");

            // Render Quiz
            renderQuiz();

            resetBoard();
        }

        function toggleDraw() {
            isDraw = !isDraw;
            const btn = document.getElementById('btnDraw');
            const ws = document.getElementById('workspace');
            if(isDraw) { 
                btn.classList.add('active'); ws.classList.add('drawing');
                notify("üñäÔ∏è Ch·∫ø ƒë·ªô v·∫Ω: K√©o th·∫£ gi·ªØa 2 nguy√™n t·ª≠ ƒë·ªÉ n·ªëi", true); 
            } else { 
                btn.classList.remove('active'); ws.classList.remove('drawing');
            }
        }
        
        function notify(msg, ok) {
            const n = document.getElementById('notification'); n.innerText = msg;
            n.style.background = ok?'#43a047':'#c62828'; n.style.display='block';
            setTimeout(()=>n.style.display='none',3000);
        }

        function dragStart(e,t) { e.dataTransfer.setData('type',t); }
        ws.addEventListener('dragover',e=>e.preventDefault());
        ws.addEventListener('drop',e=>{
            e.preventDefault(); const t=e.dataTransfer.getData('type');
            if(t) {
                const rect = ws.getBoundingClientRect();
                const size = (t === 'H') ? 28 : 40; 
                let x = e.clientX - rect.left - (size/2); 
                let y = e.clientY - rect.top - (size/2);
                createAtom(t, x, y);
            }
        });

        function getAtomCenter(el) {
            const r = el.getBoundingClientRect();
            return { x: parseFloat(el.style.left) + el.offsetWidth/2, y: parseFloat(el.style.top) + el.offsetHeight/2 };
        }

        function createAtom(t,x,y) {
            // Hide skeleton view if drawing starts
            const skelView = document.getElementById('main-skeleton-view');
            if (skelView) {
                skelView.style.display = 'none';
            }
            
            const d = document.createElement('div');
            d.className = `atom atom-clone ${t.toLowerCase()}-atom`;
            d.innerText = t; d.dataset.type = t; d.id = 'a'+(atomId++);
            d.style.left = x+'px'; d.style.top = y+'px';
            d.onmousedown = e => {
                e.stopPropagation(); if (e.button !== 0) return;
                if (isDraw) {
                    isDrawingBond = true; startAtom = d; const c = getAtomCenter(d);
                    tempLine = document.createElementNS('http://www.w3.org/2000/svg','line');
                    tempLine.setAttribute('x1', c.x); tempLine.setAttribute('y1', c.y); tempLine.setAttribute('x2', c.x); tempLine.setAttribute('y2', c.y);
                    tempLine.setAttribute('stroke', '#555'); tempLine.setAttribute('stroke-width', '3'); tempLine.setAttribute('stroke-dasharray', '5,5');
                    bondSvg.appendChild(tempLine);
                    document.addEventListener('mousemove', onDrawMove); document.addEventListener('mouseup', onDrawEnd);
                } else {
                    e.preventDefault(); const rect = ws.getBoundingClientRect();
                    const sx = e.clientX - d.getBoundingClientRect().left; const sy = e.clientY - d.getBoundingClientRect().top;
                    function mv(ev) {
                        let l = ev.clientX - rect.left - sx; let top = ev.clientY - rect.top - sy;
                        l = Math.max(0, Math.min(l, rect.width - d.offsetWidth)); top = Math.max(0, Math.min(top, rect.height - d.offsetHeight));
                        d.style.left=l+'px'; d.style.top=top+'px'; renderBonds();
                    }
                    function mu() { document.removeEventListener('mousemove',mv); document.removeEventListener('mouseup',mu); resolveCollisions(d); renderBonds(); }
                    document.addEventListener('mousemove',mv); document.addEventListener('mouseup',mu);
                }
            };
            d.ondblclick = () => { bonds=bonds.filter(b=>b.s!==d.id && b.e!==d.id); d.remove(); renderBonds(); };
            ws.appendChild(d); setTimeout(()=>resolveCollisions(d), 10);
        }

        function resolveCollisions(currentAtom) {
            const atoms = document.querySelectorAll('.atom-clone'); if(atoms.length < 2) return;
            const rect = ws.getBoundingClientRect(); const c1 = getAtomCenter(currentAtom); const r1 = currentAtom.offsetWidth / 2;
            atoms.forEach(other => {
                if(other === currentAtom) return;
                const c2 = getAtomCenter(other); const r2 = other.offsetWidth / 2;
                const dx = c1.x - c2.x; const dy = c1.y - c2.y; const dist = Math.sqrt(dx*dx + dy*dy); const minDist = r1 + r2 + 2;
                if (dist < minDist) {
                    let nx = dx / dist; let ny = dy / dist; if (dist === 0) { nx = 1; ny = 0; }
                    const pushDist = minDist - dist;
                    let newLeft = parseFloat(currentAtom.style.left) + nx * pushDist; let newTop = parseFloat(currentAtom.style.top) + ny * pushDist;
                    newLeft = Math.max(0, Math.min(newLeft, rect.width - currentAtom.offsetWidth)); newTop = Math.max(0, Math.min(newTop, rect.height - currentAtom.offsetHeight));
                    currentAtom.style.left = newLeft + 'px'; currentAtom.style.top = newTop + 'px';
                }
            });
        }

        function onDrawMove(e) {
            if (!isDrawingBond || !tempLine) return;
            const rect = ws.getBoundingClientRect();
            tempLine.setAttribute('x2', e.clientX - rect.left); tempLine.setAttribute('y2', e.clientY - rect.top);
        }

        function onDrawEnd(e) {
            const rect = ws.getBoundingClientRect(); const mx = e.clientX - rect.left; const my = e.clientY - rect.top;
            let endAtom = null;
            document.querySelectorAll('.atom-clone').forEach(a => {
                const ax = parseFloat(a.style.left); const ay = parseFloat(a.style.top);
                if (mx >= ax && mx <= ax+a.offsetWidth && my >= ay && my <= ay+a.offsetHeight) endAtom = a;
            });
            if (endAtom && endAtom !== startAtom && isDrawingBond) addBond(startAtom.id, endAtom.id);
            if (tempLine) tempLine.remove(); tempLine = null; isDrawingBond = false; startAtom = null;
            document.removeEventListener('mousemove', onDrawMove); document.removeEventListener('mouseup', onDrawEnd);
        }

        function addBond(id1,id2) {
            const ex = bonds.find(b=>(b.s===id1 && b.e===id2)||(b.s===id2 && b.e===id1));
            if(ex) { ex.t++; if(ex.t>3) bonds=bonds.filter(b=>b!==ex); }
            else bonds.push({s:id1,e:id2,t:1});
            renderBonds();
        }

        function renderBonds() {
            const temp = tempLine ? tempLine.cloneNode(true) : null; bondSvg.innerHTML = ''; if(temp) bondSvg.appendChild(temp);
            bonds.forEach(b => {
                const e1 = document.getElementById(b.s), e2 = document.getElementById(b.e); if(!e1||!e2) return;
                const c1 = getAtomCenter(e1); const c2 = getAtomCenter(e2);
                if(b.t===1) drawLine(c1.x, c1.y, c2.x, c2.y);
                else if(b.t===2) drawMulti(c1.x, c1.y, c2.x, c2.y, 4);
                else drawMulti(c1.x, c1.y, c2.x, c2.y, 5, true);
            });
        }

        function drawLine(x1,y1,x2,y2) {
            const l = document.createElementNS('http://www.w3.org/2000/svg','line');
            l.setAttribute('x1',x1); l.setAttribute('y1',y1); l.setAttribute('x2',x2); l.setAttribute('y2',y2);
            l.setAttribute('stroke','#444'); l.setAttribute('stroke-width',3); bondSvg.appendChild(l);
        }
        function drawMulti(x1,y1,x2,y2,off,trip=false) {
            const dx=x2-x1, dy=y2-y1, len=Math.sqrt(dx*dx+dy*dy); const nx=-dy/len*off, ny=dx/len*off;
            drawLine(x1+nx,y1+ny,x2+nx,y2+ny); drawLine(x1-nx,y1-ny,x2-nx,y2-ny);
            if(trip) drawLine(x1,y1,x2,y2);
        }
        function resetBoard() { 
            document.querySelectorAll('.atom-clone').forEach(e=>e.remove()); bonds=[]; renderBonds(); 
            // Also clear the skeleton view if it's open
            const skelView = document.getElementById('main-skeleton-view');
            if (skelView) {
                skelView.style.display = 'none';
            }
        }
        
        function createSkeleton() {
            resetBoard();
            
            // Show Main Workspace Skeleton View instead of creating atoms
            const mainView = document.getElementById('main-skeleton-view');
            if (mainView) {
                mainView.innerHTML = getSkeletonSVG(curKey);
                mainView.style.display = 'flex';
                notify("‚¨° ƒê√£ hi·ªÉn th·ªã khung ph√¢n t·ª≠ m·∫´u", true);
            }
        }

        function checkResult() {
            // Special handling if in skeleton view mode - can't check
            const skelView = document.getElementById('main-skeleton-view');
            if (skelView && skelView.style.display === 'flex') {
                notify("‚ö†Ô∏è ƒê√¢y l√† ch·∫ø ƒë·ªô xem m·∫´u. H√£y t·ª± l·∫Øp r√°p ƒë·ªÉ ki·ªÉm tra!", false);
                return;
            }

            const req = db[curKey].req; const atoms = document.querySelectorAll('.atom-clone');
            let cnt = {C:0,H:0,O:0,N:0,Cl:0}; atoms.forEach(a => cnt[a.dataset.type]++);
            let err = []; for(let e in req) if(cnt[e]!==req[e]) err.push(`Sai ${e}`); for(let e in cnt) if(!req[e] && cnt[e]>0) err.push(`Th·ª´a ${e}`);
            if(err.length==0) { 
                notify("üîç ƒêang qu√©t c·∫•u tr√∫c...", true); document.getElementById('laser-line').style.display = 'block'; document.getElementById('laser-line').style.animation = 'scanMove 2.5s linear infinite';
                setTimeout(() => {
                    document.getElementById('laser-line').style.display = 'none'; document.getElementById('success-overlay').style.display = 'flex';
                    setTimeout(() => { document.getElementById('success-overlay').style.display = 'none'; open3D(); }, 1800);
                }, 3000);
            } else notify("‚ö†Ô∏è "+err.join(', '),false);
        }

        function nextLesson() {
            closeModal(); const sel = document.getElementById('compoundSelect');
            if (sel.selectedIndex < sel.options.length - 1) { sel.selectedIndex++; changeTask(); notify("üöÄ ƒê√£ chuy·ªÉn sang ch·∫•t ti·∫øp theo!", true); } 
            else notify("üèÜ Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ b√†i h·ªçc!", true);
        }

        // --- 3D Logic ---
        let scene, camera, renderer, moleculeGroup, animId, isRot = true; let currentSDFData = null;
        function open3D() { document.getElementById('modal3d').style.display = 'flex'; document.getElementById('modalTitle').innerText = "M√¥ h√¨nh 3D: " + db[curKey].n; init3D(); const map = {'ethane':'ethane','ethene':'ethene','ethyne':'ethyne','benzene':'benzene','phenol':'phenol'}; fetchMolecule(map[db[curKey].n.toLowerCase()]||db[curKey].n); }
        function closeModal() { document.getElementById('modal3d').style.display='none'; cancelAnimationFrame(animId); }
        function init3D() {
            const box = document.getElementById('canvas3d'); box.innerHTML = '<div style="color:white;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:2rem;">ƒêang t·∫£i...</div>';
            scene = new THREE.Scene(); scene.background = new THREE.Color(0x111111);
            camera = new THREE.PerspectiveCamera(45, box.clientWidth/box.clientHeight, 0.1, 100); camera.position.set(0, 0, 8); 
            renderer = new THREE.WebGLRenderer({antialias:true}); renderer.setSize(box.clientWidth, box.clientHeight); box.appendChild(renderer.domElement);
            const amb = new THREE.AmbientLight(0xffffff, 0.7); scene.add(amb);
            const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(5,10,7); scene.add(dir);
            moleculeGroup = new THREE.Group(); scene.add(moleculeGroup);
            const c=renderer.domElement; let isDrag=false, prev={x:0,y:0};
            c.onmousedown=e=>{isDrag=true; prev={x:e.offsetX,y:e.offsetY}}; c.onmouseup=()=>isDrag=false;
            c.onmousemove=e=>{ if(!isDrag) return; moleculeGroup.rotation.y += (e.offsetX-prev.x)*0.01; moleculeGroup.rotation.x += (e.offsetY-prev.y)*0.01; prev={x:e.offsetX,y:e.offsetY}; };
            animate();
        }
        function animate() { animId = requestAnimationFrame(animate); if(isRot && moleculeGroup) { moleculeGroup.rotation.y += 0.005; moleculeGroup.rotation.x += 0.002; } renderer.render(scene, camera); }
        function toggleRotate() { isRot=!isRot; document.getElementById('btnRotate').innerText=isRot?"‚è∏Ô∏è D·ª´ng xoay":"‚ñ∂Ô∏è Ti·∫øp t·ª•c"; }
        function fetchMolecule(name) {
            fetch(`https://pubchem.ncbi.nlm.nih.gov/rest/pug/compound/name/${name}/SDF?record_type=3d`)
                .then(r=>r.ok?r.text():Promise.reject()).then(sdf=>{ document.getElementById('canvas3d').innerHTML=''; document.getElementById('canvas3d').appendChild(renderer.domElement); currentSDFData = parseSDF(sdf); renderMolecule('ballStick'); })
                .catch(()=>{ document.getElementById('canvas3d').innerHTML='<div style="color:white;padding:20px;font-size:1.5rem">L·ªói t·∫£i d·ªØ li·ªáu</div>'; });
        }
        function parseSDF(sdf) {
            const lines = sdf.split('\n'); const nAtom = parseInt(lines[3].substr(0,3).trim()); const nBond = parseInt(lines[3].substr(3,3).trim());
            const atoms=[], bonds=[];
            for(let i=0; i<nAtom; i++) { const l=lines[4+i]; atoms.push({ x:parseFloat(l.substr(0,10)), y:parseFloat(l.substr(10,10)), z:parseFloat(l.substr(20,10)), s:l.substr(31,3).trim() }); }
            for(let i=0; i<nBond; i++) { const l=lines[4+nAtom+i]; bonds.push({ f:parseInt(l.substr(0,3))-1, t:parseInt(l.substr(3,3))-1, type:parseInt(l.substr(6,3)) }); }
            return {atoms,bonds};
        }
        function renderMolecule(mode) {
            if(!currentSDFData) return; while(moleculeGroup.children.length>0) moleculeGroup.remove(moleculeGroup.children[0]);
            const {atoms,bonds} = currentSDFData; const scale = 0.9;
            atoms.forEach(a => {
                const col = {C:0x333333, H:0xffffff, O:0xf44336, N:0x1976d2, Cl:0x4caf50}[a.s]||0xff00ff;
                const r = (a.s=='H'?1.1:1.6) * (mode=='spaceFill'?0.5:0.25) * scale;
                const m = new THREE.Mesh(new THREE.SphereGeometry(r,32,32), new THREE.MeshPhongMaterial({color:col, shininess:100}));
                m.position.set(a.x*scale, a.y*scale, a.z*scale); moleculeGroup.add(m);
            });
            if(mode=='ballStick') {
                bonds.forEach(b => {
                    const p1=atoms[b.f], p2=atoms[b.t];
                    const v1=new THREE.Vector3(p1.x*scale,p1.y*scale,p1.z*scale); const v2=new THREE.Vector3(p2.x*scale,p2.y*scale,p2.z*scale);
                    const mid=new THREE.Vector3().addVectors(v1,v2).multiplyScalar(0.5); const dir=new THREE.Vector3().subVectors(v2,v1).normalize();
                    const drawCyl = (offset) => {
                        const d=v1.distanceTo(v2); const m=new THREE.Mesh(new THREE.CylinderGeometry(0.12,0.12,d,12), new THREE.MeshPhongMaterial({color:0xaaaaaa}));
                        m.position.copy(mid).add(offset); m.lookAt(v2.clone().add(offset)); m.rotateX(Math.PI/2); moleculeGroup.add(m);
                    };
                    if(b.type===1) drawCyl(new THREE.Vector3(0,0,0));
                    else {
                        const perp = new THREE.Vector3().crossVectors(dir, new THREE.Vector3(0,1,0)).normalize().multiplyScalar(0.18);
                        drawCyl(perp); drawCyl(perp.clone().negate()); if(b.type===3) drawCyl(new THREE.Vector3(0,0,0));
                    }
                });
            }
            const box = new THREE.Box3().setFromObject(moleculeGroup); moleculeGroup.position.sub(box.getCenter(new THREE.Vector3()));
        }
        function setRenderMode(m) { document.getElementById('btnBallStick').classList.toggle('active',m=='ballStick'); document.getElementById('btnSpaceFill').classList.toggle('active',m=='spaceFill'); renderMolecule(m); }

        changeTask();
    </script>
</body>
</html>